/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x314a=['suggestion-','suggestionLoaded','stopListening','add','Accept\x20all\x20suggestions','has','switchbutton','set','suggestionUnloaded','editor','Discard\x20all\x20selected\x20suggestions','getAllAdjacentSuggestions','separator','getJoined','_updateController','delete','componentFactory','_initializeController','mainView','isMultiRange','registerAnnotation','value','keys','getSuggestion','activeMarkers','focus','config','_viewToController','CommentsUI','_createUIButton','values','EditorAnnotations','Annotations','comments.maxThreadTotalWeight','editing','trackChanges','CommentsRepository','acceptButton','actionView','isOn','_handleControllerBuffer','unbind','trackChanges.disableComments','getFirstRange','discardSelectedSuggestions','clear','source','view','commentThread','createAnnotationView','change:activeAnnotations','isEnabled','getMarkers','map','_refreshActiveMarkers','remove','reduce','button','some','init','model','requires','Track\x20changes','length','TrackChangesEditing','_annotationViews','change:previous','comments.maxCommentCharsWhenCollapsed','_disableComments','isInContent','Accept\x20all\x20selected\x20suggestions','getByInnerView','comments.maxCommentsWhenCollapsed','_destroyController','arrowView','discardAllSuggestions','push','commandName','discardButton','commands','isDirty','SuggestionThreadView','suggestionChanged','getMarkerNames','addComment','from','_handleSuggestionControllerDelayed','destroy','listenTo','buttonView','acceptAllSuggestions','locale','_suggestionToController','activeAnnotations','plugins','size','comments.editorConfig','_descriptionFactory','descriptionParts','type','get','head','execute','define','createAnnotation','filter','hasSuggestion','getRanges','getDescriptions','bind'];(function(_0x4af0d2,_0x314ade){const _0x2c3358=function(_0x532520){while(--_0x532520){_0x4af0d2['push'](_0x4af0d2['shift']());}};_0x2c3358(++_0x314ade);}(_0x314a,0x19f));const _0x2c33=function(_0x4af0d2,_0x314ade){_0x4af0d2=_0x4af0d2-0x0;let _0x2c3358=_0x314a[_0x4af0d2];return _0x2c3358;};import{Plugin as _0x46bf41}from'ckeditor5/src/core';import{Collection as _0x14b3b9}from'ckeditor5/src/utils';import{Model as _0x3e9d15,SplitButtonView as _0x2a5631,createDropdown as _0x1e9d51,addListToDropdown as _0x46aa93}from'ckeditor5/src/ui';import{Users as _0x4e7ee8,getDateTimeFormatter as _0x23102c,getAllMarkersDomElementsSorted as _0x319b1f}from'ckeditor5-collaboration/src/collaboration-core';import _0x55094a from'./trackchangesediting';import _0x20fdc3 from'./ui/suggestioncontroller';import _0x59372c from'./ui/view/suggestionthreadview';import{getTranslation as _0x11c724}from'./utils/common-translations';import _0x1dbc08 from'../theme/icons/track-changes.svg';export default class d extends _0x46bf41{static get[_0x2c33('0x56')](){return[_0x55094a,_0x4e7ee8,_0x2c33('0x3d'),_0x2c33('0x39'),_0x2c33('0x38')];}static get['pluginName'](){return'TrackChangesUI';}constructor(_0x410ac0){super(_0x410ac0),this[_0x2c33('0x7')]=new Map(),this[_0x2c33('0x34')]=new Map(),this[_0x2c33('0x5a')]=new Map(),this[_0x2c33('0x41')]=new Map();const _0xb723b6=this['editor'][_0x2c33('0x33')];_0xb723b6['define']('trackChanges.SuggestionThreadView',_0x59372c),_0xb723b6[_0x2c33('0x12')]('trackChanges.disableComments',!0x1),this[_0x2c33('0x5d')]=_0xb723b6[_0x2c33('0xf')](_0x2c33('0x43'));}['_handleSuggestionControllerDelayed'](_0x17c74b,_0x342faf){0x0===this[_0x2c33('0x41')][_0x2c33('0xa')]&&setTimeout(()=>{for(const [_0x418d97,_0x124dac]of this['_handleControllerBuffer']){const _0x1372fc=this[_0x2c33('0x7')][_0x2c33('0x1e')](_0x418d97);_0x1372fc||_0x124dac?_0x1372fc&&_0x124dac&&this[_0x2c33('0x62')](_0x418d97):this[_0x2c33('0x2a')](_0x418d97);}this[_0x2c33('0x22')][_0x2c33('0x9')][_0x2c33('0xf')](_0x2c33('0x38'))['refreshSelectedViews'](),this[_0x2c33('0x4f')](),this[_0x2c33('0x41')][_0x2c33('0x46')]();},0xa),this[_0x2c33('0x41')][_0x2c33('0x20')](_0x17c74b,_0x342faf);}[_0x2c33('0x54')](){const _0x4335e5=this[_0x2c33('0x22')],_0x52859d=_0x4335e5[_0x2c33('0x9')][_0x2c33('0xf')]('TrackChangesEditing'),_0x29a21e=_0x4335e5[_0x2c33('0x9')][_0x2c33('0xf')](_0x2c33('0x39')),_0x429d3a=_0x4335e5[_0x2c33('0x9')][_0x2c33('0xf')](_0x2c33('0x38')),_0x59411a=_0x4335e5[_0x2c33('0x9')]['get']('CommentsRepository');_0x4335e5['ui'][_0x2c33('0x29')][_0x2c33('0x1c')]('trackChanges',_0x3ed7d5=>this[_0x2c33('0x36')](_0x3ed7d5)),_0x429d3a['addSourceCollector'](()=>{const _0x177e06=[];for(const [_0x3e1c26,_0x49a5bf]of Array[_0x2c33('0x0')](this[_0x2c33('0x7')])){const _0x2fd1c5=_0x3e1c26[_0x2c33('0x24')](),_0x14f6e4=[];for(const _0x41cbff of _0x2fd1c5){if(!_0x41cbff['isInContent'])continue;if(_0x41cbff[_0x2c33('0x2c')]){_0x14f6e4[_0x2c33('0x65')](..._0x41cbff[_0x2c33('0x16')]());continue;}const _0x457c7f=_0x41cbff[_0x2c33('0x44')]();if(_0x14f6e4[_0x2c33('0x58')]>0x0){const _0x4b983d=_0x14f6e4[0x0][_0x2c33('0x26')](_0x457c7f);if(_0x4b983d){_0x14f6e4[0x0]=_0x4b983d;continue;}}_0x14f6e4[_0x2c33('0x65')](_0x457c7f);}_0x177e06[_0x2c33('0x65')]([_0x49a5bf[_0x2c33('0x48')],_0x14f6e4]);}return _0x177e06;}),this['listenTo'](_0x52859d,_0x2c33('0x1a'),(_0x537078,_0x414e47)=>{this[_0x2c33('0x3')](_0x414e47,_0x2c33('0x5b'),(_0x5971ed,_0x6d58b4,_0x3826c0,_0x2e2e35)=>{_0x414e47[_0x2c33('0x5e')]&&(null==_0x3826c0?(this[_0x2c33('0x27')](_0x2e2e35[_0x2c33('0x10')]),this[_0x2c33('0x1')](_0x414e47,!0x1)):(this['_updateController'](_0x3826c0['head']),this[_0x2c33('0x1')](_0x414e47,!0x0)));}),null===_0x414e47['previous']?this['_handleSuggestionControllerDelayed'](_0x414e47,!0x1):this[_0x2c33('0x27')](_0x414e47['head']);}),this[_0x2c33('0x3')](_0x52859d,_0x2c33('0x21'),(_0x2e5582,_0x561da5,_0x488073)=>{this[_0x2c33('0x1b')](_0x561da5,'change:previous'),this[_0x2c33('0x41')][_0x2c33('0x28')](_0x561da5);const _0x28bd10=_0x488073?_0x488073[_0x2c33('0x10')]:_0x561da5,_0x1de983=this[_0x2c33('0x7')][_0x2c33('0xf')](_0x28bd10);null!==_0x488073&&this[_0x2c33('0x27')](_0x28bd10),null===_0x488073&&_0x1de983&&this[_0x2c33('0x62')](_0x561da5);}),this[_0x2c33('0x3')](_0x52859d,_0x2c33('0x6b'),(_0x54aed6,_0x86e1dd)=>{this[_0x2c33('0x27')](_0x86e1dd);}),this['listenTo'](_0x29a21e,_0x2c33('0x4b'),()=>{this[_0x2c33('0x4f')]();}),this['listenTo'](_0x59411a,_0x2c33('0x6d'),(_0x27372f,{threadId:_0x55226c,isFromAdapter:_0xfa6bb8})=>{if(_0xfa6bb8||!_0x52859d[_0x2c33('0x15')](_0x55226c))return;const _0x3640a8=_0x52859d[_0x2c33('0x30')](_0x55226c);this[_0x2c33('0x7')][_0x2c33('0xf')](_0x3640a8)[_0x2c33('0x48')][_0x2c33('0x32')]();},{'priority':'lowest'});}['_refreshActiveMarkers'](){const _0x42f47f=this[_0x2c33('0x22')]['plugins'][_0x2c33('0xf')](_0x2c33('0x39')),_0x2658f7=this['editor'][_0x2c33('0x9')]['get'](_0x2c33('0x59')),_0x502da8=Array[_0x2c33('0x0')](_0x42f47f[_0x2c33('0x8')],_0x3522d6=>_0x3522d6['innerView'])[_0x2c33('0x14')](_0x55c7a8=>this['_viewToController'][_0x2c33('0x1e')](_0x55c7a8)),_0x4e069d=[];for(const _0x3ae3c3 of _0x502da8){const _0x4272a4=this[_0x2c33('0x34')]['get'](_0x3ae3c3)[_0x2c33('0x55')][_0x2c33('0x24')]();_0x4e069d[_0x2c33('0x65')](..._0x4272a4[_0x2c33('0x51')]((_0xeacbae,_0x22735f)=>[..._0xeacbae,..._0x22735f[_0x2c33('0x6c')]()],[]));}_0x2658f7[_0x2c33('0x31')]=_0x4e069d;}[_0x2c33('0x36')](_0x347d98){const _0x1879f6=_0x1e9d51(_0x347d98,_0x2a5631),_0x2a3edc=this[_0x2c33('0x22')][_0x2c33('0x68')]['get'](_0x2c33('0x3c')),_0x56220e=_0x11c724(_0x347d98,_0x2c33('0x57'));_0x1879f6[_0x2c33('0x4')][_0x2c33('0x20')]({'tooltip':_0x56220e,'label':_0x56220e,'icon':_0x1dbc08}),_0x1879f6[_0x2c33('0x4')][_0x2c33('0x18')]('isOn')['to'](_0x2a3edc,_0x2c33('0x2e')),_0x1879f6['buttonView']['on'](_0x2c33('0x11'),()=>{_0x2a3edc[_0x2c33('0x11')](),this['editor'][_0x2c33('0x3b')][_0x2c33('0x48')][_0x2c33('0x32')]();});const _0x5e4bbe=new _0x14b3b9(),_0x5810ef=[{'type':_0x2c33('0x1f'),'model':{'withText':!0x0,'label':_0x56220e,'commandName':_0x2c33('0x3c')}},{'type':_0x2c33('0x25')},{'type':_0x2c33('0x52'),'model':{'withText':!0x0,'label':_0x11c724(_0x347d98,_0x2c33('0x1d')),'commandName':_0x2c33('0x5')}},{'type':_0x2c33('0x52'),'model':{'withText':!0x0,'label':_0x11c724(_0x347d98,_0x2c33('0x5f')),'commandName':'acceptSelectedSuggestions'}},{'type':_0x2c33('0x52'),'model':{'withText':!0x0,'label':_0x11c724(_0x347d98,'Discard\x20all\x20suggestions'),'commandName':_0x2c33('0x64')}},{'type':_0x2c33('0x52'),'model':{'withText':!0x0,'label':_0x11c724(_0x347d98,_0x2c33('0x23')),'commandName':_0x2c33('0x45')}}];for(const _0x13a67f of _0x5810ef){let _0x19fd06={'type':_0x2c33('0x25')};if(_0x13a67f[_0x2c33('0x55')]){const _0x3a083f=new _0x3e9d15(_0x13a67f[_0x2c33('0x55')]),_0x522e13=this[_0x2c33('0x22')][_0x2c33('0x68')][_0x2c33('0xf')](_0x3a083f['commandName']);_0x3a083f[_0x2c33('0x18')](_0x2c33('0x40'),'isEnabled')['to'](_0x522e13,'value','isEnabled'),_0x19fd06={'type':_0x13a67f[_0x2c33('0xe')],'model':_0x3a083f};}_0x5e4bbe['add'](_0x19fd06);}_0x46aa93(_0x1879f6,_0x5e4bbe);const _0x1f6f35=_0x5810ef['filter'](_0x55a90d=>null!=_0x55a90d[_0x2c33('0x55')])[_0x2c33('0x4e')](_0x26f513=>this[_0x2c33('0x22')][_0x2c33('0x68')][_0x2c33('0xf')](_0x26f513[_0x2c33('0x55')][_0x2c33('0x66')])),_0x5be2db=_0x1879f6[_0x2c33('0x4')];return _0x5be2db[_0x2c33('0x3f')][_0x2c33('0x42')](_0x2c33('0x4c')),_0x5be2db[_0x2c33('0x63')]['unbind'](_0x2c33('0x4c')),_0x5be2db[_0x2c33('0x3f')]['bind'](_0x2c33('0x4c'))['to'](_0x2a3edc,_0x2c33('0x4c')),_0x5be2db[_0x2c33('0x63')][_0x2c33('0x18')](_0x2c33('0x4c'))['toMany'](_0x1f6f35,'isEnabled',(..._0x27ebe1)=>_0x27ebe1[_0x2c33('0x53')](_0x4e258c=>_0x4e258c)),_0x1879f6['on'](_0x2c33('0x11'),_0x3f4473=>{this['editor']['execute'](_0x3f4473[_0x2c33('0x47')]['commandName']),this[_0x2c33('0x22')]['editing']['view'][_0x2c33('0x32')]();}),_0x1879f6;}[_0x2c33('0x2a')](_0x4a2306){const _0x509fb6=this['editor'],_0x13f96e=_0x509fb6[_0x2c33('0x33')],_0x1bde4f=_0x509fb6['plugins']['get'](_0x2c33('0x39')),_0x5427c1=_0x509fb6[_0x2c33('0x9')][_0x2c33('0xf')](_0x2c33('0x3d')),_0x2163d2=_0x509fb6['plugins']['get'](_0x2c33('0x38')),_0x579ffd=_0x509fb6['plugins'][_0x2c33('0xf')](_0x4e7ee8)['me'],_0xccc4e5=_0x13f96e['get'](_0x2c33('0x3c'))[_0x2c33('0x6a')],{CommentsListView:_0x577341,CommentThreadInputView:_0x15748e}=_0x509fb6[_0x2c33('0x9')]['get'](_0x2c33('0x35'));let _0x5086c2,_0xf8c7b9;this[_0x2c33('0x5a')]['has'](_0x4a2306['id'])?(_0xf8c7b9=this['_annotationViews'][_0x2c33('0xf')](_0x4a2306['id']),_0x5086c2=_0xf8c7b9[_0x2c33('0x2b')]):(_0x5086c2=new _0xccc4e5(_0x509fb6[_0x2c33('0x6')],_0x4a2306,_0x579ffd,{'disableComments':this[_0x2c33('0x5d')],'editorConfig':_0x13f96e[_0x2c33('0xf')](_0x2c33('0xb')),'maxCommentsWhenCollapsed':_0x13f96e[_0x2c33('0xf')](_0x2c33('0x61')),'maxThreadTotalWeight':_0x13f96e[_0x2c33('0xf')](_0x2c33('0x3a')),'maxCommentCharsWhenCollapsed':_0x13f96e[_0x2c33('0xf')](_0x2c33('0x5c')),'formatDateTime':_0x23102c(_0x13f96e['get'](_0x2c33('0x6'))),'CommentView':_0x13f96e[_0x2c33('0xf')]('comments')['CommentView'],'CommentsListView':_0x577341,'CommentThreadInputView':_0x15748e}),_0x5086c2[_0x2c33('0x3e')]['on']('execute',()=>{_0x509fb6[_0x2c33('0x3b')][_0x2c33('0x48')][_0x2c33('0x32')]();}),_0x5086c2[_0x2c33('0x67')]['on'](_0x2c33('0x11'),()=>{_0x509fb6[_0x2c33('0x3b')][_0x2c33('0x48')][_0x2c33('0x32')]();}),_0xf8c7b9=_0x1bde4f[_0x2c33('0x4a')](this[_0x2c33('0x22')][_0x2c33('0x6')],_0x5086c2),_0xf8c7b9[_0x2c33('0x18')](_0x2c33('0x69'))['to'](_0x5086c2,_0x2c33('0x69')),_0xf8c7b9['bind'](_0x2c33('0x58'))['to'](_0x5086c2),_0xf8c7b9['bind']('type')['to'](_0x5086c2,_0x2c33('0xe'),_0x2ededc=>'suggestion-'+_0x2ededc),this[_0x2c33('0x5a')][_0x2c33('0x20')](_0x4a2306['id'],_0xf8c7b9));const _0x4def72=_0x5427c1['createCommentThreadController'](_0x4a2306[_0x2c33('0x49')],_0x5086c2),_0x1b0859=new _0x20fdc3(_0x509fb6,_0x4a2306,_0x5086c2,_0x4def72),_0x264da1=_0x4a2306[_0x2c33('0x24')]()[_0x2c33('0x14')](_0x1eb431=>_0x1eb431['isInContent']);_0x5086c2[_0x2c33('0xd')]=_0x509fb6['plugins']['get'](_0x2c33('0x59'))[_0x2c33('0xc')][_0x2c33('0x17')](_0x264da1),this['_suggestionToController'][_0x2c33('0x20')](_0x4a2306,_0x1b0859),this[_0x2c33('0x34')][_0x2c33('0x20')](_0x5086c2,_0x1b0859);const _0x344628=_0x1bde4f[_0x2c33('0x13')]({'view':_0xf8c7b9,'target':()=>{const _0x4a2650=[],_0x27d72c=_0x4a2306[_0x2c33('0x24')]()['filter'](_0x498679=>_0x498679['isInContent']);for(const _0xf5d4b2 of _0x27d72c)_0x4a2650[_0x2c33('0x65')](..._0xf5d4b2[_0x2c33('0x4d')]());return _0x319b1f(_0x509fb6[_0x2c33('0x3b')],_0x4a2650);},'type':()=>_0x2c33('0x19')+_0x1b0859[_0x2c33('0x48')][_0x2c33('0xe')]});_0x1bde4f[_0x2c33('0x1c')](_0x344628),_0x2163d2[_0x2c33('0x2d')](_0x344628);}[_0x2c33('0x62')](_0x17e484){const _0x4b251f=this[_0x2c33('0x22')]['plugins'][_0x2c33('0xf')](_0x2c33('0x39')),_0x25eede=this[_0x2c33('0x7')][_0x2c33('0xf')](_0x17e484),_0x36d19f=_0x25eede[_0x2c33('0x48')],_0x2e21c8=_0x4b251f[_0x2c33('0x60')](_0x36d19f);_0x2e21c8&&_0x4b251f[_0x2c33('0x50')](_0x2e21c8),this[_0x2c33('0x7')][_0x2c33('0x28')](_0x17e484),this[_0x2c33('0x34')]['delete'](_0x36d19f),_0x25eede[_0x2c33('0x2')]();}[_0x2c33('0x27')](_0x34027b){if(!_0x34027b[_0x2c33('0x5e')]||!this[_0x2c33('0x7')][_0x2c33('0x1e')](_0x34027b))return;const _0x6e597c=this[_0x2c33('0x22')]['plugins'][_0x2c33('0xf')](_0x2c33('0x59')),_0x867320=this[_0x2c33('0x7')]['get'](_0x34027b),_0x18f10d=_0x34027b[_0x2c33('0x24')]();_0x867320[_0x2c33('0x48')][_0x2c33('0xd')]=_0x6e597c[_0x2c33('0xc')][_0x2c33('0x17')](_0x18f10d);}[_0x2c33('0x2')](){for(const _0x2b8648 of this[_0x2c33('0x7')][_0x2c33('0x2f')]())this[_0x2c33('0x62')](_0x2b8648);for(const _0xa0f6c3 of this[_0x2c33('0x5a')][_0x2c33('0x37')]())_0xa0f6c3[_0x2c33('0x2b')][_0x2c33('0x2')]();super[_0x2c33('0x2')]();}}