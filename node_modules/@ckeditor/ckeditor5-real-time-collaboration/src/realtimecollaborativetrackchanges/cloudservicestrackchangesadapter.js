/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x368f=['data','getSuggestion','cloud-services-internal-error:\x20Not\x20connected.','state','hasSuggestion','listenTo','get','originalSuggestionId','add','from','then','_fetchMissingUsersForThreads','getUser','addToReconnectionStack','update','values','delete','adapter','_trackChangesService','editor','TrackChangesEditing','addUser','getMany','_waitForServiceReady','connect','find','startsWith','init','_saved','attributes','TrackChangesService','type','addSuggestionData','set','connected','size','open','catch','message','requires','cloud-services-internal-error:\x20Request\x20timeout.','plugins'];(function(_0x110193,_0x368fc2){const _0x19b8b3=function(_0x4e3c66){while(--_0x4e3c66){_0x110193['push'](_0x110193['shift']());}};_0x19b8b3(++_0x368fc2);}(_0x368f,0xab));const _0x19b8=function(_0x110193,_0x368fc2){_0x110193=_0x110193-0x0;let _0x19b8b3=_0x368f[_0x110193];return _0x19b8b3;};import{Plugin as _0x514a42}from'ckeditor5/src/core';import _0x257af8 from'@ckeditor/ckeditor-cloud-services-collaboration/src/track-changes/trackchangesservice';import _0x5f3329 from'../realtimecollaborativeediting/websocketgateway';import _0x3da825 from'../realtimecollaborativecomments/cloudservicescommentsadapter';import _0x132359 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import{Users as _0x46dbb2}from'ckeditor5-collaboration/src/collaboration-core';export default class g extends _0x514a42{static get[_0x19b8('0x24')](){return[_0x3da825,_0x19b8('0x11'),_0x5f3329];}constructor(_0x32c399){super(_0x32c399);const _0x49ddec=this[_0x19b8('0x10')]['config'][_0x19b8('0x3')]('collaboration.channelId');this['_bufferedRequests']=new Map(),this[_0x19b8('0xf')]=new g['TrackChangesService'](_0x49ddec);}[_0x19b8('0x18')](){const _0x56f726=this[_0x19b8('0x10')][_0x19b8('0x26')][_0x19b8('0x3')](_0x5f3329),_0x2fae21=this['editor']['plugins'][_0x19b8('0x3')]('TrackChangesEditing');return _0x2fae21[_0x19b8('0xe')]={'getSuggestion':async _0x38ebd2=>{await this[_0x19b8('0x14')]();const _0x555b9d=await this['_trackChangesService'][_0x19b8('0x3')](_0x38ebd2)['catch'](B);return await this[_0x19b8('0x8')]([_0x555b9d]),_0x555b9d;},'addSuggestion':async({id:_0x1e930a,type:_0x1a72ab,data:_0x5052d6,originalSuggestionId:_0xcff686,attributes:_0x5efd77})=>{await this[_0x19b8('0x14')]();const _0x5957e2={'id':_0x1e930a,'type':_0x1a72ab,'data':_0x5052d6,'originalSuggestionId':_0xcff686,'attributes':_0x5efd77},_0x60620f=await this['_trackChangesService'][_0x19b8('0x5')](_0x1e930a,_0x1a72ab,_0x5052d6,_0xcff686,_0x5efd77)[_0x19b8('0x22')](_0x3866f2=>{if(st(_0x3866f2))return new Promise(_0x4c2003=>{this['_bufferedRequests'][_0x19b8('0x1e')](_0x1e930a,{'resolve':_0x4c2003,'suggestionData':_0x5957e2});});throw _0x3866f2;});return this['_bufferedRequests'][_0x19b8('0xd')](_0x1e930a),_0x60620f;},'updateSuggestion':async(_0x46091a,_0x31b23d)=>{if(await this[_0x19b8('0x14')](),_0x19b8('0x21')!==_0x31b23d[_0x19b8('0x0')])return this['_trackChangesService'][_0x19b8('0xb')](_0x46091a,_0x31b23d)[_0x19b8('0x22')](B);}},this['listenTo'](this[_0x19b8('0xf')],'suggestionUpdated',(_0xf5a029,_0x568afb)=>{_0x2fae21[_0x19b8('0x1')](_0x568afb['id'])&&(_0x2fae21[_0x19b8('0x28')](_0x568afb['id'])['attributes']=_0x568afb[_0x19b8('0x1a')]);}),this['_trackChangesService'][_0x19b8('0x15')](_0x56f726['connection'])[_0x19b8('0x7')](_0x171201=>(_0x56f726[_0x19b8('0xa')](this),this[_0x19b8('0x8')](_0x171201)[_0x19b8('0x7')](()=>{for(const _0x33a58a of _0x171201){_0x2fae21[_0x19b8('0x1d')](_0x33a58a)[_0x19b8('0x19')]=!0x0;}})));}async['reconnect'](){const _0x4259a3=this[_0x19b8('0x10')][_0x19b8('0x26')][_0x19b8('0x3')]('TrackChangesEditing'),{connection:_0x2f4165}=this[_0x19b8('0x10')][_0x19b8('0x26')][_0x19b8('0x3')](_0x5f3329),_0x58603e=await this[_0x19b8('0xf')]['connect'](_0x2f4165);await this[_0x19b8('0x8')](_0x58603e);for(const {suggestionData:_0x1fe518,resolve:_0x24c8b2}of this['_bufferedRequests'][_0x19b8('0xc')]()){let _0x455b65=_0x58603e[_0x19b8('0x16')](_0x3f39da=>_0x3f39da['id']===_0x1fe518['id']);_0x455b65||(_0x455b65=await this[_0x19b8('0xf')][_0x19b8('0x5')](_0x1fe518['id'],_0x1fe518[_0x19b8('0x1c')],_0x1fe518[_0x19b8('0x27')],_0x1fe518[_0x19b8('0x4')])),_0x24c8b2(_0x455b65);}for(const _0x4c1d8e of _0x58603e)_0x4259a3[_0x19b8('0x1')](_0x4c1d8e['id'])||_0x4259a3[_0x19b8('0x1d')](_0x4c1d8e);}async['_waitForServiceReady'](){this[_0x19b8('0xf')]['isConnected']||await new Promise(_0x1dfe07=>{this[_0x19b8('0x2')](this[_0x19b8('0xf')],_0x19b8('0x1f'),_0x5b2a36=>{_0x5b2a36['off'](),_0x1dfe07();});});}async[_0x19b8('0x8')](_0x5dea2f){const _0x469371=this[_0x19b8('0x10')]['plugins'][_0x19b8('0x3')](_0x46dbb2),{connection:_0x39897b}=this['editor'][_0x19b8('0x26')]['get'](_0x5f3329),_0x4a07b4=new Set();for(const {authorId:_0x5a8f35}of _0x5dea2f)_0x469371[_0x19b8('0x9')](_0x5a8f35)||_0x4a07b4[_0x19b8('0x5')](_0x5a8f35);if(0x0===_0x4a07b4[_0x19b8('0x20')])return;const _0x43f58e=await _0x132359[_0x19b8('0x13')](_0x39897b,Array[_0x19b8('0x6')](_0x4a07b4));for(const _0x73652b of _0x43f58e)_0x469371[_0x19b8('0x9')](_0x73652b['id'])||_0x469371[_0x19b8('0x12')](_0x73652b);}}function B(_0x52e174){if(st(_0x52e174))return new Promise(()=>{});throw _0x52e174;}function st(_0xe11f65){return _0xe11f65[_0x19b8('0x23')][_0x19b8('0x17')](_0x19b8('0x29'))||_0xe11f65[_0x19b8('0x23')][_0x19b8('0x17')](_0x19b8('0x25'));}g[_0x19b8('0x1b')]=_0x257af8;