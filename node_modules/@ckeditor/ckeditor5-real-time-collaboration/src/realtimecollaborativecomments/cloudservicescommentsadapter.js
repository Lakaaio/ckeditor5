/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x38f9=['_fetchMissingUsersForThreads','cloudservicescommentsadapter-disconnect-not-exist','context','comments','updateComment','set','createdAt','cloudservicescommentsadapter-connect-already-connected','getCommentThread','getCommentThreads','off','_getService','_setUpService','cloud-services-internal-error:\x20Request\x20timeout.','get','reopenCommentThread','removeCommentThread','assign','resolveCommentThread','disconnect','addCommentThread','keys','commentThreadReopened','_connectService','addComment','CommentsRepository','setPermissions','commentAdded','commentThreadAdded','commentThreadResolved','code','startsWith','map','commentThreadId','listenTo','catch','authorId','getUser','adapter','from','resolvedAt','size','attributes','plugins','delete','cloud-services-internal-error:\x20Not\x20connected.','has','CommentsService','getComment','commentId','config','_services','connect','getMany','update','register','content','requires','mySessionId','addUser','removeComment','sessionAdd:','commentThreadUpdated','updateCommentThread','resolvedBy','reconnect','404','message','destroy','cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.','remove','_terminateService','add','resolve','collaboration.channelId'];(function(_0x57eff2,_0x38f9ed){const _0x18c394=function(_0x2a97b7){while(--_0x2a97b7){_0x57eff2['push'](_0x57eff2['shift']());}};_0x18c394(++_0x38f9ed);}(_0x38f9,0x1d5));const _0x18c3=function(_0x57eff2,_0x38f9ed){_0x57eff2=_0x57eff2-0x0;let _0x18c394=_0x38f9[_0x57eff2];return _0x18c394;};import{Context as _0x38a011,ContextPlugin as _0x48097b}from'ckeditor5/src/core';import{CKEditorError as _0xfbb5b}from'ckeditor5/src/utils';import{Users as _0x4340e4}from'ckeditor5-collaboration/src/collaboration-core';import _0x62067b from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x3150da from'@ckeditor/ckeditor-cloud-services-collaboration/src/comments-v2/commentsservice';import _0x3abfee from'../realtimecollaborativeediting/websocketgateway';import _0xe40bf5 from'../realtimecollaborativeediting/sessions';export default class a extends _0x48097b{static get[_0x18c3('0x26')](){return[_0x3abfee,_0x18c3('0x6'),_0xe40bf5,_0x4340e4];}constructor(_0xeca6c9){super(_0xeca6c9),this[_0x18c3('0x20')]=new Map();}async['init'](){const _0x5cce69=this[_0x18c3('0x3a')],_0x444e95=_0x5cce69['plugins'][_0x18c3('0x46')](_0x18c3('0x6'));if(_0x5cce69['plugins'][_0x18c3('0x46')](_0x3abfee)['addToReconnectionStack'](this),_0x444e95[_0x18c3('0x13')]={'addCommentThread':async({channelId:_0x51fc87,threadId:_0x38662a,comments:_0x246ffd,resolvedAt:_0x1ca0ea,resolvedBy:_0x43850d,context:_0x524882,attributes:_0x743796})=>{const _0x1d4132=await this[_0x18c3('0x43')](_0x51fc87)[_0x18c3('0x1')]({'commentThreadId':_0x38662a,'comments':_0x246ffd['map'](_0x2b0a1c=>function(_0x1d98af,_0xe955e1,_0x3461e3){return{'commentThreadId':_0x3461e3,'commentId':_0x1d98af['commentId'],'userId':_0x1d98af[_0x18c3('0x11')],'content':_0x1d98af[_0x18c3('0x25')],'documentId':_0xe955e1,'createdAt':_0x1d98af[_0x18c3('0x3e')],'attributes':_0x1d98af[_0x18c3('0x17')]||{}};}(_0x2b0a1c,_0x51fc87,_0x38662a)),'resolvedAt':_0x1ca0ea,'resolvedBy':_0x43850d,'context':_0x524882,'attributes':_0x743796})[_0x18c3('0x10')](B);return{'threadId':_0x1d4132['commentThreadId'],'comments':_0x1d4132[_0x18c3('0x3b')]};},'getCommentThread':async({channelId:_0x321dba,threadId:_0x53bba8})=>{const _0x4098e4=await this[_0x18c3('0x43')](_0x321dba)[_0x18c3('0x40')](_0x53bba8)[_0x18c3('0x10')](B);return await this[_0x18c3('0x38')]([_0x4098e4]),{'threadId':_0x4098e4[_0x18c3('0xe')],'comments':_0x4098e4['comments'][_0x18c3('0xd')](R),'context':_0x4098e4[_0x18c3('0x3a')],'resolvedAt':_0x4098e4[_0x18c3('0x15')],'resolvedBy':_0x4098e4['resolvedBy'],'attributes':_0x4098e4[_0x18c3('0x17')]||{}};},'updateCommentThread':async({channelId:_0x1721b9,threadId:_0x80a68d,context:_0x38cb2f,attributes:_0x18179e})=>this[_0x18c3('0x43')](_0x1721b9)['updateCommentThread']({'commentThreadId':_0x80a68d,'context':_0x38cb2f,'attributes':_0x18179e})['catch'](F)[_0x18c3('0x10')](B),'resolveCommentThread':async({channelId:_0x315c5e,threadId:_0x59fc53})=>{const _0x26cfd5=await this[_0x18c3('0x43')](_0x315c5e)[_0x18c3('0x4a')](_0x59fc53)[_0x18c3('0x10')](F)['catch'](B);return{'threadId':_0x26cfd5[_0x18c3('0xe')],'resolvedAt':_0x26cfd5[_0x18c3('0x15')],'resolvedBy':_0x26cfd5[_0x18c3('0x2d')]};},'reopenCommentThread':async({channelId:_0x409c91,threadId:_0x370a19})=>this[_0x18c3('0x43')](_0x409c91)[_0x18c3('0x47')](_0x370a19)['catch'](F)[_0x18c3('0x10')](B),'removeCommentThread':({channelId:_0x389952,threadId:_0x34b3f6})=>this['_getService'](_0x389952)[_0x18c3('0x48')](_0x34b3f6)[_0x18c3('0x10')](F)[_0x18c3('0x10')](B),'addComment':({channelId:_0x5ea50c,threadId:_0x59603b,commentId:_0x16c9b3,content:_0x26d2a1,attributes:_0x3977c2})=>this[_0x18c3('0x43')](_0x5ea50c)[_0x18c3('0x5')](_0x59603b,_0x16c9b3,_0x26d2a1,_0x3977c2)[_0x18c3('0x10')](B),'updateComment':({channelId:_0x5b076c,threadId:_0x1a639d,commentId:_0x25ec52,content:_0x5e6b15,attributes:_0x4c5e53})=>this[_0x18c3('0x43')](_0x5b076c)[_0x18c3('0x3c')](_0x1a639d,_0x25ec52,_0x5e6b15,_0x4c5e53)[_0x18c3('0x10')](F)[_0x18c3('0x10')](B),'removeComment':({channelId:_0x15e638,threadId:_0x2dcf5d,commentId:_0x3891c3})=>this[_0x18c3('0x43')](_0x15e638)[_0x18c3('0x29')](_0x2dcf5d,_0x3891c3)[_0x18c3('0x10')](F)['catch'](B)},_0x5cce69 instanceof _0x38a011){const _0x46071e=_0x5cce69[_0x18c3('0x1f')][_0x18c3('0x46')]('collaboration.channelId'),_0x3427f7=_0x5cce69[_0x18c3('0x18')][_0x18c3('0x46')](_0xe40bf5);await this[_0x18c3('0x44')](_0x46071e);const _0xc8a80b=await this['_services'][_0x18c3('0x46')](_0x46071e)['getConnectedSessions']();this[_0x18c3('0xf')](_0x3427f7,_0x18c3('0x2a')+_0x46071e,(_0x25c974,{session:_0xf859ed})=>{_0xf859ed['id']===_0x3427f7[_0x18c3('0x27')]&&(_0x25c974[_0x18c3('0x42')](),this[_0x18c3('0x3a')][_0x18c3('0x18')][_0x18c3('0x46')]('Permissions')[_0x18c3('0x7')](_0xf859ed['permissions'],_0x46071e));}),_0x3427f7[_0x18c3('0x24')](_0x46071e,_0xc8a80b);}}async[_0x18c3('0x44')](_0x3fdd9b){if(this[_0x18c3('0x20')][_0x18c3('0x1b')](_0x3fdd9b))throw new _0xfbb5b(_0x18c3('0x3f'),null,{'channelId':_0x3fdd9b});const _0x591a05=this[_0x18c3('0x3a')][_0x18c3('0x18')][_0x18c3('0x46')](_0x18c3('0x6')),_0x57c76c=new a[(_0x18c3('0x1c'))](_0x3fdd9b);this['_services'][_0x18c3('0x3d')](_0x3fdd9b,_0x57c76c),this['listenTo'](_0x57c76c,_0x18c3('0x9'),(_0x286759,_0x176799)=>{const {commentThreadId:_0x1a094d,documentId:_0x2f3d0,context:_0x48ef5b,attributes:_0x1ea370,resolvedAt:_0x6afdfb,resolvedBy:_0x5ba79c,comments:_0x3439fb}=_0x176799;_0x591a05['getCommentThread'](_0x1a094d)||_0x591a05[_0x18c3('0x1')]({'threadId':_0x1a094d,'channelId':_0x2f3d0,'comments':_0x3439fb?_0x3439fb[_0x18c3('0xd')](R):[],'context':_0x48ef5b,'attributes':_0x1ea370,'resolvedAt':_0x6afdfb,'resolvedBy':_0x5ba79c,'isFromAdapter':!0x0});}),this[_0x18c3('0xf')](_0x57c76c,_0x18c3('0x2b'),(_0x5a46de,{commentThreadId:_0x10de2f,documentId:_0x507055,context:_0xbcd6c0,attributes:_0x272517})=>{_0x591a05['getCommentThread'](_0x10de2f)&&_0x591a05[_0x18c3('0x2c')]({'threadId':_0x10de2f,'channelId':_0x507055,'context':_0xbcd6c0,'attributes':_0x272517,'isFromAdapter':!0x0});}),this['listenTo'](_0x57c76c,_0x18c3('0xa'),(_0x5390a4,{commentThreadId:_0x1da715,resolvedBy:_0x199962,resolvedAt:_0xff0e58})=>{const _0x2e963d=_0x591a05['getCommentThread'](_0x1da715);_0x2e963d&&_0x2e963d[_0x18c3('0x36')]({'resolvedBy':_0x199962,'resolvedAt':_0xff0e58,'isFromAdapter':!0x0});}),this[_0x18c3('0xf')](_0x57c76c,_0x18c3('0x3'),(_0x730790,{commentThreadId:_0x282176})=>{const _0x39defa=_0x591a05[_0x18c3('0x40')](_0x282176);_0x39defa&&_0x39defa['reopen']({'isFromAdapter':!0x0});}),this[_0x18c3('0xf')](_0x57c76c,'commentThreadRemoved',(_0x34cbd3,{commentThreadId:_0x3d5190})=>{const _0x363ae9=_0x591a05[_0x18c3('0x40')](_0x3d5190);_0x363ae9&&_0x363ae9[_0x18c3('0x33')]({'isFromAdapter':!0x0});}),this[_0x18c3('0xf')](_0x57c76c,_0x18c3('0x8'),(_0x1cc964,_0x2e2249)=>{const _0x2730a3=_0x2e2249['commentThreadId'],_0x353894=_0x591a05[_0x18c3('0x40')](_0x2730a3);_0x353894&&_0x353894[_0x18c3('0x5')]({...R(_0x2e2249),'isFromAdapter':!0x0});}),this['listenTo'](_0x57c76c,'commentUpdated',(_0x2d61d8,{commentThreadId:_0x22889c,commentId:_0x526e05,content:_0x2edbd0,attributes:_0x185ea})=>{const _0x1fc5c8=_0x591a05[_0x18c3('0x40')](_0x22889c);if(_0x1fc5c8){const _0x36c2fb=_0x1fc5c8['getComment'](_0x526e05);_0x36c2fb&&_0x36c2fb[_0x18c3('0x23')]({'content':_0x2edbd0,'attributes':_0x185ea,'isFromAdapter':!0x0});}}),this[_0x18c3('0xf')](_0x57c76c,'commentRemoved',(_0xe0783f,{commentThreadId:_0x51f460,commentId:_0x2c6c0a})=>{const _0x4395c2=_0x591a05[_0x18c3('0x40')](_0x51f460);if(_0x4395c2){const _0x58a268=_0x4395c2[_0x18c3('0x1d')](_0x2c6c0a);_0x58a268&&_0x58a268[_0x18c3('0x33')]({'isFromAdapter':!0x0});}}),await this['_connectService'](_0x3fdd9b);}[_0x18c3('0x31')](){if(this[_0x18c3('0x3a')]instanceof _0x38a011){const _0x5772d1=this[_0x18c3('0x3a')][_0x18c3('0x1f')][_0x18c3('0x46')]('collaboration.channelId');this[_0x18c3('0x34')](_0x5772d1);}}[_0x18c3('0x34')](_0x3a6d52){if(!this[_0x18c3('0x20')]['has'](_0x3a6d52))throw new _0xfbb5b(_0x18c3('0x39'),null,{'channelId':_0x3a6d52});this[_0x18c3('0x43')](_0x3a6d52)[_0x18c3('0x0')](),this[_0x18c3('0x20')][_0x18c3('0x19')](_0x3a6d52);}async[_0x18c3('0x2e')](){for(const _0x26abc5 of this[_0x18c3('0x20')][_0x18c3('0x2')]())await this[_0x18c3('0x4')](_0x26abc5);if(this[_0x18c3('0x3a')]instanceof _0x38a011){const _0x431abe=this[_0x18c3('0x3a')][_0x18c3('0x1f')][_0x18c3('0x46')](_0x18c3('0x37')),_0x42fe85=this[_0x18c3('0x3a')][_0x18c3('0x18')]['get'](_0xe40bf5);_0x42fe85['unregister'](_0x431abe);const _0x1a0860=await this[_0x18c3('0x20')]['get'](_0x431abe)['getConnectedSessions']();_0x42fe85[_0x18c3('0x24')](_0x431abe,_0x1a0860);}}async[_0x18c3('0x4')](_0x47fc04){const {connection:_0x2b4c75}=this['context'][_0x18c3('0x18')][_0x18c3('0x46')](_0x3abfee),_0x5748d2=this[_0x18c3('0x3a')]['plugins'][_0x18c3('0x46')](_0x18c3('0x6')),_0x599939=this['_services'][_0x18c3('0x46')](_0x47fc04),_0x3da459=await _0x599939[_0x18c3('0x21')](_0x2b4c75);await this['_fetchMissingUsersForThreads'](_0x3da459);const _0xcc6750=new Set(Array[_0x18c3('0x14')](_0x5748d2[_0x18c3('0x41')]({'channelId':_0x47fc04}),_0x1d298a=>_0x1d298a['id']));for(const _0x3a8f30 of _0x3da459)_0xcc6750[_0x18c3('0x19')](_0x3a8f30[_0x18c3('0xe')]);for(const _0x24378d of _0xcc6750)_0x5748d2[_0x18c3('0x40')](_0x24378d)[_0x18c3('0x33')]({'isFromAdapter':!0x0});for(const _0x3e18c4 of _0x3da459){let _0x210be7=_0x5748d2[_0x18c3('0x40')](_0x3e18c4[_0x18c3('0xe')]);const {commentThreadId:_0x1b86b9,context:_0xa261fa,attributes:_0xb4bda5,resolvedBy:_0xf1e8d2,resolvedAt:_0x2926d7,deletedAt:_0x25d436}=_0x3e18c4;_0x210be7||(_0x210be7=_0x5748d2['addCommentThread']({'channelId':_0x47fc04,'threadId':_0x1b86b9,'context':_0xa261fa,'attributes':_0xb4bda5,'resolvedBy':_0xf1e8d2,'resolvedAt':_0x2926d7,'deletedAt':_0x25d436,'isFromAdapter':!0x0}));const _0xd3e4fe=new Set(Array[_0x18c3('0x14')](_0x210be7[_0x18c3('0x3b')],_0x1fc13f=>_0x1fc13f['id']));for(const _0x24b84d of _0x3e18c4['comments'])_0xd3e4fe['delete'](_0x24b84d[_0x18c3('0x1e')]);for(const _0x50a3c4 of _0xd3e4fe)_0x210be7['getComment'](_0x50a3c4)[_0x18c3('0x33')]({'isFromAdapter':!0x0});for(const _0x2ce4bf of _0x3e18c4[_0x18c3('0x3b')]){const _0x3540f8=_0x210be7['getComment'](_0x2ce4bf[_0x18c3('0x1e')]);_0x3540f8?_0x3540f8['content']!==_0x2ce4bf[_0x18c3('0x25')]&&_0x3540f8[_0x18c3('0x23')]({'content':_0x2ce4bf['content'],'isFromAdapter':!0x0}):_0x210be7[_0x18c3('0x5')](Object[_0x18c3('0x49')](R(_0x2ce4bf),{'isFromAdapter':!0x0}));}}}[_0x18c3('0x43')](_0x1345d8){if(!this['_services'][_0x18c3('0x1b')](_0x1345d8))throw new _0xfbb5b('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x1345d8});return this[_0x18c3('0x20')][_0x18c3('0x46')](_0x1345d8);}async['_fetchMissingUsersForThreads'](_0x2e18c4){const _0x368643=this[_0x18c3('0x3a')][_0x18c3('0x18')][_0x18c3('0x46')](_0x4340e4),{connection:_0x101d90}=this[_0x18c3('0x3a')][_0x18c3('0x18')][_0x18c3('0x46')](_0x3abfee),_0x8cd083=new Set();for(const {resolvedBy:_0x1710cc,comments:_0x6af766}of _0x2e18c4){_0x1710cc&&!_0x368643['getUser'](_0x1710cc)&&_0x8cd083[_0x18c3('0x35')](_0x1710cc);for(const {userId:_0x239986}of _0x6af766)_0x368643[_0x18c3('0x12')](_0x239986)||_0x8cd083['add'](_0x239986);}if(0x0===_0x8cd083[_0x18c3('0x16')])return;const _0xfded30=await _0x62067b[_0x18c3('0x22')](_0x101d90,Array['from'](_0x8cd083));for(const _0x22f03f of _0xfded30)_0x368643[_0x18c3('0x12')](_0x22f03f['id'])||_0x368643[_0x18c3('0x28')](_0x22f03f);}}async function F(_0x57c6d7){if(_0x18c3('0x2f')!==_0x57c6d7[_0x18c3('0xb')])throw _0x57c6d7;}function B(_0x206ecd){if((_0x334d39=_0x206ecd)['message']['startsWith'](_0x18c3('0x32'))||_0x334d39[_0x18c3('0x30')][_0x18c3('0xc')](_0x18c3('0x1a'))||_0x334d39[_0x18c3('0x30')][_0x18c3('0xc')](_0x18c3('0x45')))return new Promise(()=>{});var _0x334d39;throw _0x206ecd;}function R(_0x1552db){return{'threadId':_0x1552db['commentThreadId'],'commentId':_0x1552db[_0x18c3('0x1e')],'content':_0x1552db['content'],'createdAt':_0x1552db[_0x18c3('0x3e')],'authorId':_0x1552db['userId'],'attributes':_0x1552db[_0x18c3('0x17')]||{}};}a['CommentsService']=_0x3150da;