/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3225=['channelSessions','fire','sessions-register-already-registered','requires','_registeredSessions','defineMe','unregister','set','assign','pluginName','allConnectedUsers','role','connected','state','remove','has','delete','user','getUserSessions','addUser','context','orderNumber','listenTo','_users','register','_uniqueUsersCount','get','_handleSessionAdd','sessions-unregister-not-exist','mySessionId','add','plugins','Sessions','channelConnectedUsers','_handleSessionRemove','size','clear','_createUser','connection','forEach','values','sessionId'];(function(_0x5509ab,_0x32250e){const _0x1fc58c=function(_0x4ae1f5){while(--_0x4ae1f5){_0x5509ab['push'](_0x5509ab['shift']());}};_0x1fc58c(++_0x32250e);}(_0x3225,0x1c9));const _0x1fc5=function(_0x5509ab,_0x32250e){_0x5509ab=_0x5509ab-0x0;let _0x1fc58c=_0x3225[_0x5509ab];return _0x1fc58c;};import{ContextPlugin as _0x47b02a}from'ckeditor5/src/core';import{Collection as _0x159f8c,CKEditorError as _0x2319e3}from'ckeditor5/src/utils';import _0x182a9d from'./websocketgateway';import{Users as _0x41130b}from'ckeditor5-collaboration/src/collaboration-core';export default class r extends _0x47b02a{static get[_0x1fc5('0xe')](){return _0x1fc5('0x25');}static get[_0x1fc5('0x8')](){return[_0x182a9d,_0x41130b];}constructor(_0x23c514){super(_0x23c514),this[_0x1fc5('0x5')]=new Map(),this[_0x1fc5('0x26')]=new Map(),this['allConnectedUsers']=new _0x159f8c(),this['_registeredSessions']=new Map(),this[_0x1fc5('0x1e')]=0x0,this['_users']=this[_0x1fc5('0x19')]['plugins'][_0x1fc5('0x1f')](_0x41130b);}['init'](){const _0x5e945a=this[_0x1fc5('0x19')][_0x1fc5('0x24')]['get'](_0x182a9d);this[_0x1fc5('0x1b')](_0x5e945a,'change:state',(_0x490806,_0x275a95,_0x44c22c)=>{if(_0x1fc5('0x11')!==_0x44c22c)this[_0x1fc5('0x5')][_0x1fc5('0x2')](_0x53386f=>_0x53386f[_0x1fc5('0x29')]()),this[_0x1fc5('0x26')]['forEach'](_0x5ba65e=>_0x5ba65e[_0x1fc5('0x29')]()),this['allConnectedUsers'][_0x1fc5('0x29')]();else for(const [_0x1696eb,_0x525b80]of this[_0x1fc5('0x9')])for(const _0x453fd7 of _0x525b80)this[_0x1fc5('0x20')](_0x1696eb,_0x453fd7);}),this[_0x1fc5('0x0')](_0x5e945a[_0x1fc5('0x1')]['me'],!0x0);}[_0x1fc5('0x1d')](_0x24e368,_0x1c2914){if(this['_registeredSessions'][_0x1fc5('0x14')](_0x24e368))throw new _0x2319e3(_0x1fc5('0x7'),null,{'channelId':_0x24e368});this['_registeredSessions']['set'](_0x24e368,_0x1c2914),this[_0x1fc5('0x5')][_0x1fc5('0xc')](_0x24e368,new _0x159f8c()),this[_0x1fc5('0x26')][_0x1fc5('0xc')](_0x24e368,new _0x159f8c()),this[_0x1fc5('0x1b')](_0x1c2914,_0x1fc5('0x23'),(_0x38872e,_0x1f47b3)=>this[_0x1fc5('0x20')](_0x24e368,_0x1f47b3)),this[_0x1fc5('0x1b')](_0x1c2914,_0x1fc5('0x13'),(_0x95ae12,_0x574852)=>this[_0x1fc5('0x27')](_0x24e368,_0x574852));for(const _0x330722 of _0x1c2914)this[_0x1fc5('0x20')](_0x24e368,_0x330722);}[_0x1fc5('0xb')](_0x5c620c){if(!this['_registeredSessions'][_0x1fc5('0x14')](_0x5c620c))throw new _0x2319e3(_0x1fc5('0x21'),null,{'channelId':_0x5c620c});const _0x5d5e51=this[_0x1fc5('0x9')][_0x1fc5('0x1f')](_0x5c620c);this['stopListening'](_0x5d5e51);for(const _0x3b99d0 of _0x5d5e51)_0x1fc5('0x11')===this[_0x1fc5('0x19')][_0x1fc5('0x24')][_0x1fc5('0x1f')](_0x182a9d)[_0x1fc5('0x12')]&&this[_0x1fc5('0x27')](_0x5c620c,_0x3b99d0);this['_registeredSessions'][_0x1fc5('0x15')](_0x5c620c),this['channelSessions'][_0x1fc5('0x15')](_0x5c620c),this['channelConnectedUsers'][_0x1fc5('0x15')](_0x5c620c);}get[_0x1fc5('0x22')](){return this[_0x1fc5('0x19')][_0x1fc5('0x24')]['get'](_0x182a9d)['connection'][_0x1fc5('0x4')];}['getUserBySessionId'](_0xb57d06){for(const _0x2c98a9 of this[_0x1fc5('0x5')][_0x1fc5('0x3')]())for(const _0x2e75d4 of _0x2c98a9)if(_0x2e75d4['id']===_0xb57d06)return _0x2e75d4['user'];}[_0x1fc5('0x17')](_0x52c611,_0x16ee21){const _0x361612=_0x16ee21?[this[_0x1fc5('0x5')][_0x1fc5('0x1f')](_0x16ee21)]:this[_0x1fc5('0x5')]['values'](),_0x2346c0=new Set();for(const _0x59facd of _0x361612)for(const _0x46b379 of _0x59facd)_0x46b379[_0x1fc5('0x16')]['id']===_0x52c611['id']&&_0x2346c0['add'](_0x46b379['id']);return _0x2346c0;}['getUserRole'](_0x29e26f){for(const _0x565a65 of this['channelSessions']['values']())for(const _0x22686a of _0x565a65)if(_0x22686a[_0x1fc5('0x16')]===_0x29e26f)return _0x22686a[_0x1fc5('0x10')];}[_0x1fc5('0x20')](_0x119269,_0x3b8109){if(_0x1fc5('0x11')!==this[_0x1fc5('0x19')][_0x1fc5('0x24')][_0x1fc5('0x1f')](_0x182a9d)[_0x1fc5('0x12')])return;const _0x515745=_0x3b8109[_0x1fc5('0x16')],_0xc8b5bc=this[_0x1fc5('0x1c')]['getUser'](_0x515745['id'])||this[_0x1fc5('0x0')](_0x515745),_0x3763da=Object[_0x1fc5('0xd')]({},_0x3b8109,{'user':_0xc8b5bc});this[_0x1fc5('0x5')]['get'](_0x119269)[_0x1fc5('0x23')](_0x3763da);const _0x3b2fdf=this[_0x1fc5('0x26')][_0x1fc5('0x1f')](_0x119269);_0x3b2fdf[_0x1fc5('0x14')](_0xc8b5bc['id'])||_0x3b2fdf['add'](_0xc8b5bc),this[_0x1fc5('0xf')]['has'](_0xc8b5bc['id'])||this[_0x1fc5('0xf')][_0x1fc5('0x23')](_0xc8b5bc),this[_0x1fc5('0x6')]('sessionAdd:'+_0x119269,{'channelId':_0x119269,'session':_0x3763da});}[_0x1fc5('0x27')](_0x526a64,_0x13d0e9){if(_0x1fc5('0x11')!==this[_0x1fc5('0x19')][_0x1fc5('0x24')][_0x1fc5('0x1f')](_0x182a9d)[_0x1fc5('0x12')])return;const _0x4a65eb=this[_0x1fc5('0x26')][_0x1fc5('0x1f')](_0x526a64),_0x46fcd3=_0x13d0e9[_0x1fc5('0x16')];_0x46fcd3['id']&&(this['channelSessions'][_0x1fc5('0x1f')](_0x526a64)[_0x1fc5('0x13')](_0x13d0e9['id']),_0x4a65eb[_0x1fc5('0x14')](_0x46fcd3['id'])&&!this[_0x1fc5('0x17')](_0x46fcd3,_0x526a64)[_0x1fc5('0x28')]&&_0x4a65eb[_0x1fc5('0x13')](_0x46fcd3['id']),this[_0x1fc5('0xf')][_0x1fc5('0x1f')](_0x46fcd3['id'])&&!this[_0x1fc5('0x17')](_0x46fcd3)['size']&&this['allConnectedUsers'][_0x1fc5('0x13')](_0x46fcd3['id']));}[_0x1fc5('0x0')](_0x37f493,_0xc30bc2){const _0x749ac8=this['_users'][_0x1fc5('0x18')](_0x37f493);return _0xc30bc2&&this['_users'][_0x1fc5('0xa')](_0x37f493['id']),_0x749ac8[_0x1fc5('0x1a')]=this['_uniqueUsersCount']++,_0x749ac8;}}