/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x27e6=['removeMarker','_createdBatches','end','isSimilar','enqueueChange','isCollapsed','getMarkerClass','requires','userPositionMarker','get','editing','getNearestSelectionRange','getSelectionClass','getContainedElement','newRange','startsWith','size','ck-user__marker\x20','contenteditable','UserMarkers','init','isInline','markers','oldRange','user:range:','hasContent','schema','for','setCustomProperty','markerName','editor','reconvertMarker','rootName','getRange','start','delete','toRange','getAttribute','getFirstRange','fromRange','mySessionId','root','user:position','createUIElement','change:range','parent','afterInit','getUserBySessionId','color','getCustomProperty','getStart','user:position:','innerHTML','isObject','updateMarker','highest','createRange','render','batch','has','hasDomSelection','createUserMarkerOperations','markerToHighlight','marker','set','change','split','plugins','ck-user__selection','type','detach','checkChild','span','conversion','view','pluginName','element','editingDowncast','user:range','markerRange','toDomElement','name','$graveyard','document','model','deletionPosition','commands','$text','markerToElement','nodeAfter'];(function(_0x25f6b9,_0x27e60b){const _0x1db718=function(_0x3e679d){while(--_0x3e679d){_0x25f6b9['push'](_0x25f6b9['shift']());}};_0x1db718(++_0x27e60b);}(_0x27e6,0x103));const _0x1db7=function(_0x25f6b9,_0x27e60b){_0x25f6b9=_0x25f6b9-0x0;let _0x1db718=_0x27e6[_0x25f6b9];return _0x1db718;};import{Plugin as _0x192133}from'ckeditor5/src/core';import _0x31dd32 from'./sessions';import{LiveRange as _0x124d89}from'ckeditor5/src/engine';import'../../theme/usermarkers.css';export default class j extends _0x192133{static get[_0x1db7('0x12')](){return[_0x31dd32];}static get[_0x1db7('0x56')](){return _0x1db7('0x1e');}[_0x1db7('0x1f')](){const _0x380d5f=this[_0x1db7('0x29')],_0x48766c=_0x380d5f[_0x1db7('0x4e')][_0x1db7('0x14')](_0x31dd32);_0x380d5f[_0x1db7('0x54')][_0x1db7('0x26')]('editingDowncast')[_0x1db7('0x9')]({'model':_0x1db7('0x35'),'view':(_0x3d9562,{writer:_0xde5fb2})=>function(_0x1b2156,_0x5bcb6,_0x44141b,_0xd1fcff){const _0x15daa2=_0x1b2156['markerName']['split'](':')[0x2],_0x43d819=_0x44141b[_0x1db7('0x3a')](_0x15daa2);if(!_0x43d819||_0x15daa2===_0x44141b[_0x1db7('0x33')])return;if(!_0xd1fcff[_0x1db7('0x5')][_0x1db7('0x25')][_0x1db7('0x52')](_0x1b2156[_0x1db7('0x0')]['start'],_0x1db7('0x8')))return;const _0x50a5de={'class':_0x1db7('0x1c')+_0x43d819[_0x1db7('0x3b')][_0x1db7('0x11')](),'data-name':_0x43d819[_0x1db7('0x2')],'data-session-id':_0x15daa2},_0x27d8cc=_0xd1fcff[_0x1db7('0x5')][_0x1db7('0x21')][_0x1db7('0x14')](_0x1b2156[_0x1db7('0x28')]),_0x32a2de=_0x27d8cc[_0x1db7('0x3d')](),_0x40da79=_0x32a2de[_0x1db7('0xa')],_0x5e9f22=_0xd1fcff[_0x1db7('0x5')]['schema'];if(_0x40da79&&_0x5e9f22[_0x1db7('0x40')](_0x40da79)&&_0x5e9f22[_0x1db7('0x20')](_0x40da79)&&!_0xd1fcff['model']['markers']['get'](_0x1db7('0x23')+_0x15daa2)['getRange']()[_0x1db7('0x10')])return;const _0x29ebe2=_0x32a2de[_0x1db7('0x38')];return _0xd1fcff['model'][_0x1db7('0x25')]['isLimit'](_0x29ebe2)&&!_0xd1fcff[_0x1db7('0x5')][_0x1db7('0x24')](_0x29ebe2)&&(_0x50a5de[_0x1db7('0x1d')]=!0x1),function(_0x3fd2eb,_0x4e0779){const _0x3e394e=_0x3fd2eb[_0x1db7('0x36')](_0x1db7('0x53'),_0x4e0779);return _0x3fd2eb[_0x1db7('0x27')](_0x1db7('0x13'),!0x0,_0x3e394e),_0x3e394e[_0x1db7('0x44')]=function(_0x11c4b3){const _0x183fd4=this[_0x1db7('0x1')](_0x11c4b3);return _0x183fd4[_0x1db7('0x3f')]='⁠<span\x20class=\x22ck-user__marker-line\x22\x20contenteditable=\x22false\x22><span\x20class=\x22ck-user__marker-dot\x22></span></span>⁠',_0x183fd4;},_0x3e394e[_0x1db7('0xe')]=function(_0x3f6906){return!(!this[_0x1db7('0x3c')](_0x1db7('0x13'))||!_0x3f6906[_0x1db7('0x3c')]('userPositionMarker')||this[_0x1db7('0x30')]('data-session-id')!=_0x3f6906[_0x1db7('0x30')]('data-session-id'));},_0x3e394e;}(_0x5bcb6,_0x50a5de);}(_0x3d9562,_0xde5fb2,_0x48766c,_0x380d5f)}),_0x380d5f[_0x1db7('0x54')]['for'](_0x1db7('0x58'))[_0x1db7('0x49')]({'model':_0x1db7('0x59'),'view':_0x5963e1=>function(_0x595731,_0x2b252d){const _0xda4a29=_0x595731['markerName'][_0x1db7('0x4d')](':')[0x2];if(_0xda4a29===_0x2b252d[_0x1db7('0x33')])return null;const _0x41c13f=_0x2b252d['getUserBySessionId'](_0xda4a29);if(!_0x41c13f)return{'id':_0xda4a29,'classes':[]};return{'id':_0xda4a29,'classes':[_0x1db7('0x4f'),_0x41c13f[_0x1db7('0x3b')][_0x1db7('0x17')]()],'attributes':{'data-session-id':_0xda4a29},'priority':0x7d0+_0x41c13f['orderNumber']};}(_0x5963e1,_0x48766c)}),function(_0x407600){const _0x16d69d=_0x407600['model'],_0x5b94fc=new Map(),_0x5f20b2=_0x407600[_0x1db7('0x4e')][_0x1db7('0x14')](_0x31dd32);_0x16d69d['markers']['on']('update:user:range',(_0x4ba78d,_0xc6e4e9,_0xce0784,_0x3a84eb)=>{if(!_0x3a84eb&&_0x5b94fc[_0x1db7('0x14')](_0xc6e4e9[_0x1db7('0x2')]))return _0x5b94fc['get'](_0xc6e4e9[_0x1db7('0x2')])[_0x1db7('0x51')](),void _0x5b94fc[_0x1db7('0x2e')](_0xc6e4e9[_0x1db7('0x2')]);const _0x53a013=_0xc6e4e9['name'][_0x1db7('0x4d')](':')[0x2];if(_0x53a013===_0x5f20b2[_0x1db7('0x33')])return;const _0x436d1b=_0x1db7('0x3e')+_0x53a013;_0x16d69d[_0x1db7('0x21')]['has'](_0x436d1b)&&_0x407600['editing'][_0x1db7('0x2a')](_0x436d1b),_0xc6e4e9['on'](_0x1db7('0x37'),(_0x587476,_0x5390c0,_0x1bff0e)=>{if(_0x1db7('0x3')!=_0x5390c0['root']['rootName']&&_0x1db7('0x3')==_0xc6e4e9[_0x1db7('0x2c')]()[_0x1db7('0x34')][_0x1db7('0x2b')]&&!_0x5b94fc[_0x1db7('0x46')](_0xc6e4e9[_0x1db7('0x2')])){const _0x7c36d5=_0x16d69d[_0x1db7('0x25')][_0x1db7('0x16')](_0x1bff0e['deletionPosition']);if(_0x7c36d5){const _0x469383=_0x124d89[_0x1db7('0x32')](_0x7c36d5);_0x5b94fc[_0x1db7('0x4b')](_0xc6e4e9[_0x1db7('0x2')],_0x469383),_0x469383['on'](_0x1db7('0x37'),(_0x33359b,_0x46f0c1,_0x427a30)=>{if(_0x1db7('0x3')==_0x469383[_0x1db7('0x34')]['rootName']){const _0x24d1da=_0x16d69d['schema'][_0x1db7('0x16')](_0x427a30[_0x1db7('0x6')]);_0x24d1da?(_0x469383[_0x1db7('0x2d')]=_0x24d1da['start'],_0x469383['end']=_0x24d1da[_0x1db7('0xd')]):(_0x5b94fc['delete'](_0xc6e4e9[_0x1db7('0x2')]),_0x469383[_0x1db7('0x51')]());}});}}});}),_0x16d69d[_0x1db7('0x4')]['on'](_0x1db7('0x4c'),()=>{_0x5b94fc[_0x1db7('0x1b')]>0x0&&_0x16d69d[_0x1db7('0xf')]({'isUndoable':!0x1},_0x3964da=>{for(const [_0x34e8a2,_0x835264]of _0x5b94fc)_0x1db7('0x3')==_0x16d69d['markers']['get'](_0x34e8a2)[_0x1db7('0x2c')]()[_0x1db7('0x34')][_0x1db7('0x2b')]&&(Y(_0x34e8a2[_0x1db7('0x4d')](':')[0x2],_0x835264[_0x1db7('0x2f')](),_0x16d69d,_0x3964da),_0x835264[_0x1db7('0x51')]());_0x5b94fc['clear']();});});}(_0x380d5f);}[_0x1db7('0x39')](){const _0x5722cf=this[_0x1db7('0x29')],_0x2beaff=_0x5722cf[_0x1db7('0x7')][_0x1db7('0x14')]('undo');_0x2beaff&&_0x5722cf[_0x1db7('0x5')]['on']('applyOperation',(_0x47990b,_0x406a8d)=>{const _0x5c52e4=_0x406a8d[0x0];if(_0x1db7('0x4a')!=_0x5c52e4[_0x1db7('0x50')]||!_0x5c52e4[_0x1db7('0x2')][_0x1db7('0x1a')]('user:'))return;const _0x22a000=_0x5c52e4[_0x1db7('0x45')];_0x2beaff[_0x1db7('0xc')][_0x1db7('0x46')](_0x22a000)&&(_0x5c52e4[_0x1db7('0x19')]=_0x5c52e4[_0x1db7('0x22')]?_0x5722cf[_0x1db7('0x5')][_0x1db7('0x43')](_0x5c52e4[_0x1db7('0x22')]['start'],_0x5c52e4[_0x1db7('0x22')][_0x1db7('0xd')]):null);},{'priority':_0x1db7('0x42')});}[_0x1db7('0x48')](){const _0x2131ac=this['editor'],_0x44d92e=_0x2131ac[_0x1db7('0x5')][_0x1db7('0x4')],_0x24adaf=_0x2131ac[_0x1db7('0x4e')][_0x1db7('0x14')](_0x31dd32);_0x2131ac[_0x1db7('0x5')]['enqueueChange']({'isUndoable':!0x1},_0x3e6e30=>{const _0x436129=_0x1db7('0x23')+_0x24adaf[_0x1db7('0x33')],_0x2f3d94=_0x1db7('0x3e')+_0x24adaf[_0x1db7('0x33')],_0x24c9df=_0x2131ac[_0x1db7('0x5')]['markers'][_0x1db7('0x46')](_0x436129);_0x2131ac[_0x1db7('0x15')][_0x1db7('0x55')][_0x1db7('0x47')]?Y(_0x24adaf[_0x1db7('0x33')],_0x44d92e['selection'][_0x1db7('0x31')](),_0x2131ac[_0x1db7('0x5')],_0x3e6e30):_0x24c9df&&(_0x3e6e30[_0x1db7('0xb')](_0x436129),_0x3e6e30['removeMarker'](_0x2f3d94));});}}function Y(_0x424f33,_0xeb90c2,_0x47cee4,_0x3d92f3){const _0x28f40a=_0x1db7('0x23')+_0x424f33,_0x5c028f=_0x1db7('0x3e')+_0x424f33,_0x4075df=_0xeb90c2[_0x1db7('0x18')]();let _0x50f3fe=_0xeb90c2['start'];_0x4075df&&_0x4075df['is'](_0x1db7('0x57'),'tableCell')&&(_0x50f3fe=function(_0xf00cfc,_0x1fa592){for(const _0x469f57 of _0xf00cfc['getPositions']())if(_0x1fa592[_0x1db7('0x25')][_0x1db7('0x52')](_0x469f57,_0x1db7('0x8')))return _0x469f57;}(_0xeb90c2,_0x47cee4),_0xeb90c2=_0x3d92f3[_0x1db7('0x43')](_0x50f3fe));const _0x317bef=_0x3d92f3[_0x1db7('0x43')](_0x50f3fe);_0x47cee4[_0x1db7('0x21')]['has'](_0x28f40a)?(_0x3d92f3['updateMarker'](_0x28f40a,{'range':_0xeb90c2}),_0x3d92f3[_0x1db7('0x41')](_0x5c028f,{'range':_0x317bef})):(_0x3d92f3['addMarker'](_0x28f40a,{'range':_0xeb90c2,'usingOperation':!0x0}),_0x3d92f3['addMarker'](_0x5c028f,{'range':_0x317bef,'usingOperation':!0x0}));}