/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3aa4=['_waitForServiceReady','_oldOffset','addRevisionData','reverse','catch','currentRevision','editor','fromVersion','once','isBundleUploaded','bind','_createCurrentRevision','setRevisionData','_revisionDataBuilder','isEnabled','RevisionHistoryService','sessionId','off','_isPendingUpdate','collaboration.channelId','init','remove','get','reconnect','_preventResendingRevisionData','RevisionTracker','createdAt','connection','_bufferedUpdates','serverHistory','length','cloud-services-internal-error:\x20Request\x20timeout.','plugins','repository','change:_isPendingUpdate','_handleReconnectionError','destroy','revisionsUpdated','addToReconnectionStack','_handleRevisionsUpdate','_isConnected','code','400','type','keys','authorsIds','baseVersion','has','setSource','wrongRequestId','listenTo','updateRevisions','connected','creatorId','_offset','toVersion','adapter','getUser','data','_fetchMissingUsers','from','reInit','addUser','CONNECTED','_getLatestVersionFromServerOperations','_update','getOperations','startsWith','cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.','then','_fixRevision','max','message','affectsData','_bufferUpdate','getRevisions','map','add','requires','_revisionTracker','_startingVersion','diffData','_lastRequestId','_revisionHistoryService','change:_isConnected','getRevision','config','_getLatestVersion','isConnected','sendBufferedUpdates'];(function(_0x4f68ad,_0x3aa4fe){const _0x249146=function(_0x3f2cf4){while(--_0x3f2cf4){_0x4f68ad['push'](_0x4f68ad['shift']());}};_0x249146(++_0x3aa4fe);}(_0x3aa4,0x1b1));const _0x2491=function(_0x4f68ad,_0x3aa4fe){_0x4f68ad=_0x4f68ad-0x0;let _0x249146=_0x3aa4[_0x4f68ad];return _0x249146;};import{Plugin as _0x56dc4f}from'ckeditor5/src/core';import{version as _0x1af3fa}from'ckeditor5/src/utils';import{Users as _0x3d876d}from'ckeditor5-collaboration/src/collaboration-core';import _0x421c26 from'../realtimecollaborativeediting/realtimecollaborationclient';import _0x3d6823 from'../realtimecollaborativeediting/websocketgateway';import _0x5760da from'../realtimecollaborativeediting/sessions';import _0x109cb3 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x13f35d from'@ckeditor/ckeditor-cloud-services-collaboration/src/revision-history/revisionhistoryservice';import _0xf03948 from'@ckeditor/ckeditor-cloud-services-collaboration/src/editor/editorservice';import{WEB_SOCKET_GATEWAY_STATES as _0x364f53}from'@ckeditor/ckeditor-cloud-services-collaboration/src/websocketgateway/websocketgateway';export default class v extends _0x56dc4f{static get[_0x2491('0x5')](){return[_0x3d6823,_0x421c26,_0x2491('0x2a'),_0x5760da,_0x3d876d];}constructor(_0x1c1ef0){super(_0x1c1ef0);const _0xc4be87=this[_0x2491('0x17')][_0x2491('0xd')]['get'](_0x2491('0x24'));this['_lastRequestId']=null,this['_revisionTracker']=this[_0x2491('0x17')][_0x2491('0x31')][_0x2491('0x27')](_0x2491('0x2a')),this[_0x2491('0xa')]=new v[(_0x2491('0x20'))](_0xc4be87);}async[_0x2491('0x25')](){const _0x59fea7=this[_0x2491('0x17')]['plugins'][_0x2491('0x27')](_0x421c26),_0x2fe4dd=_0x59fea7['serverHistory'],_0xd9e3b4=this[_0x2491('0x17')]['plugins'][_0x2491('0x27')](_0x3d6823);this[_0x2491('0x6')][_0x2491('0x41')]({'history':_0x2fe4dd,'getLatestVersion':()=>this[_0x2491('0xe')](),'getCurrentRevisionId':()=>_0x59fea7[_0x2491('0x21')]});const _0x21039e=this[_0x2491('0x17')][_0x2491('0xd')][_0x2491('0x27')]('cloudServices.bundleVersion')||_0x1af3fa,_0x1549a1=await _0xf03948[_0x2491('0x1a')](_0xd9e3b4[_0x2491('0x2c')],_0x21039e);this[_0x2491('0x6')][_0x2491('0x49')]={'getRevision':async({revisionId:_0x3356b3})=>(await this[_0x2491('0x11')](),await this[_0x2491('0xa')][_0x2491('0xc')](_0x3356b3)),'updateRevisions':async _0x3d46d0=>{await this['_waitForServiceReady']();const _0x53b573=this[_0x2491('0x6')][_0x2491('0x16')];if(_0x1549a1&&0x1===_0x3d46d0[_0x2491('0x2f')]&&_0x3d46d0[0x0]['id']===_0x53b573['id'])return _0x3d46d0;for(const _0x2cf1e4 of _0x3d46d0)_0x2cf1e4['id']===_0x53b573['id']&&(_0x2cf1e4['isEmptyCurrent']=_0x2cf1e4[_0x2491('0x18')]===_0x2cf1e4['toVersion']);return this[_0x2491('0xa')][_0x2491('0x44')](_0x3d46d0,this[_0x2491('0x9')])[_0x2491('0x56')](_0x2037c9=>(this[_0x2491('0x9')]=_0x2037c9,_0x3d46d0))['catch'](_0x1e8e81=>{if(st(_0x1e8e81)||_0x2491('0x3b')===_0x1e8e81[_0x2491('0x3a')]&&void 0x0!==_0x1e8e81[_0x2491('0x4b')][_0x2491('0x42')]){for(const _0x45f928 of _0x3d46d0){!this['_revisionTracker'][_0x2491('0x32')][_0x2491('0xc')](_0x45f928['id'])||this[_0x2491('0x6')][_0x2491('0x1')](_0x45f928['id'],_0x45f928,!0x1);}if(st(_0x1e8e81))throw _0x1e8e81;return _0x3d46d0;}throw _0x1e8e81;});}},this[_0x2491('0x43')](this[_0x2491('0xa')],_0x2491('0x36'),(_0xa32652,{revisionsData:_0x5ceb9a,requestId:_0xb6779f})=>{Math[_0x2491('0x58')](..._0x5ceb9a['map'](_0xcf69b3=>_0xcf69b3[_0x2491('0x48')]))>this['_getLatestVersionFromServerOperations']()-0x1?this['_getLatestVersion']()[_0x2491('0x56')](()=>{this['_handleRevisionsUpdate'](_0x5ceb9a,_0xb6779f);}):this['_handleRevisionsUpdate'](_0x5ceb9a,_0xb6779f);});const {revisions:_0x11625f,requestId:_0x3d8c3e}=await this['_revisionHistoryService']['connect'](_0xd9e3b4['connection']);_0xd9e3b4[_0x2491('0x37')](this),this[_0x2491('0x9')]=_0x3d8c3e,await this['_fetchMissingUsers'](_0x11625f);for(const _0x58164d of _0x11625f)this[_0x2491('0x6')]['addRevisionData'](_0x58164d);this[_0x2491('0x43')](_0x59fea7,_0x2491('0xb'),(_0x3b24bf,_0x13e0d3,_0x1e0441)=>{_0x1e0441&&(this[_0x2491('0x12')]=_0x59fea7[_0x2491('0x47')],_0x3b24bf[_0x2491('0x22')]());}),this[_0x2491('0x6')][_0x2491('0x1b')](_0x2491('0x1f'))['to'](_0xd9e3b4,'state',_0x502802=>_0x502802===_0x364f53[_0x2491('0x50')]);}async[_0x2491('0x28')](){const _0x524c6f=this[_0x2491('0x17')]['plugins'][_0x2491('0x27')](_0x3d6823),_0x491f49=this['editor']['plugins']['get'](_0x421c26),_0x620159=async()=>{const _0x2b8891=this[_0x2491('0x6')][_0x2491('0x16')],_0x1d91c7=_0x2b8891['id'],_0x30c45b=_0x1d91c7!==_0x491f49[_0x2491('0x21')];if(_0x30c45b){const _0x32a002=_0x491f49[_0x2491('0x47')]-this[_0x2491('0x12')],_0x4326fe=this['_getLatestVersionFromServerOperations']();this[_0x2491('0x6')][_0x2491('0x1e')][_0x2491('0x4e')]();if(_0x2b8891[_0x2491('0x48')]+_0x32a002!==_0x4326fe){const _0x8a2411=_0x2b8891['fromVersion']+_0x32a002,_0x1c96cf=this[_0x2491('0x17')][_0x2491('0x31')][_0x2491('0x27')](_0x3d876d),_0x48a230=this[_0x2491('0x6')]['buildRevisionData']({'revision':_0x2b8891,'from':_0x8a2411,'to':_0x4326fe});_0x48a230['id']=_0x2b8891['id'];const _0x48b200=_0x48a230[_0x2491('0x3e')][_0x2491('0x3')](_0x3d7dd4=>_0x1c96cf[_0x2491('0x4a')](_0x3d7dd4));_0x2b8891[_0x2491('0x52')]({..._0x48a230,'authors':_0x48b200},!0x0),this[_0x2491('0x6')][_0x2491('0x1')](_0x2b8891['id'],_0x48a230,!0x0);}this[_0x2491('0x6')][_0x2491('0x7')]=_0x4326fe,(_0x2b8891[_0x2491('0x48')]===_0x2b8891[_0x2491('0x18')]&&!this[_0x2491('0x6')][_0x2491('0x2d')][_0x2491('0x40')](_0x1d91c7)&&this['_revisionTracker'][_0x2491('0x32')]['_revisions'][_0x2491('0x26')](_0x1d91c7),this[_0x2491('0x6')][_0x2491('0x1c')](_0x4326fe));}const {revisions:_0x3ded00,requestId:_0x1228f9}=await this[_0x2491('0xa')]['reconnect'](_0x524c6f['connection'],this[_0x2491('0x9')]);_0x30c45b&&_0x3ded00[_0x2491('0x2f')]>0x0?_0x491f49[_0x2491('0x34')]():(await this[_0x2491('0x4c')](_0x3ded00),this[_0x2491('0x38')](_0x3ded00,_0x1228f9),this[_0x2491('0x6')][_0x2491('0x10')]());};return _0x491f49[_0x2491('0x39')]?_0x620159():new Promise((_0x1c96eb,_0x243095)=>{_0x491f49[_0x2491('0x19')]('change:_isConnected',()=>{_0x620159()[_0x2491('0x56')](_0x1c96eb)[_0x2491('0x15')](_0x243095);});});}['destroy'](){super[_0x2491('0x35')]();}async[_0x2491('0x11')](){this[_0x2491('0xa')][_0x2491('0xf')]||await new Promise(_0x440913=>{this[_0x2491('0x43')](this[_0x2491('0xa')],_0x2491('0x45'),_0x55ebb1=>{_0x55ebb1[_0x2491('0x22')](),_0x440913();});});}[_0x2491('0x51')](){const _0x52570d=this[_0x2491('0x17')][_0x2491('0x31')][_0x2491('0x27')](_0x421c26)[_0x2491('0x2e')][_0x2491('0x53')]()[_0x2491('0x14')]();for(const _0x50381f of _0x52570d)if('marker'!==_0x50381f[_0x2491('0x3c')]||_0x50381f[_0x2491('0x0')])return _0x50381f[_0x2491('0x3f')]+0x1;}[_0x2491('0xe')](){const _0x365332=this[_0x2491('0x17')][_0x2491('0x31')]['get'](_0x421c26);return new Promise(_0x5ce438=>{_0x365332[_0x2491('0x23')]?_0x365332[_0x2491('0x19')](_0x2491('0x33'),()=>{_0x5ce438(this['_getLatestVersionFromServerOperations']());}):_0x5ce438(this[_0x2491('0x51')]());});}[_0x2491('0x38')](_0xe9f4a1,_0x2a391f){const _0x36ac61=this[_0x2491('0x6')][_0x2491('0x32')];this[_0x2491('0x9')]=_0x2a391f;for(const _0x172fda of _0xe9f4a1){const _0x25dbfd=_0x36ac61['getRevision'](_0x172fda['id']);if(_0x25dbfd){if((_0x172fda[_0x2491('0x18')]||_0x172fda[_0x2491('0x48')])&&(_0x172fda[_0x2491('0x8')]=null),_0x25dbfd===this['_revisionTracker'][_0x2491('0x16')]){const _0x55a754=Math[_0x2491('0x58')](_0x25dbfd['toVersion'],_0x172fda[_0x2491('0x48')]),_0x41fc96=Math['max'](_0x25dbfd[_0x2491('0x18')],_0x172fda[_0x2491('0x18')]);let _0x456368;_0x25dbfd[_0x2491('0x48')]===_0x172fda['toVersion']&&_0x25dbfd[_0x2491('0x18')]===_0x172fda[_0x2491('0x18')]?(_0x456368=!0x0,this[_0x2491('0x29')](_0x172fda)):_0x172fda[_0x2491('0x48')]===_0x55a754&&_0x172fda[_0x2491('0x18')]===_0x41fc96?_0x456368=!0x1:(_0x25dbfd[_0x2491('0x48')]===_0x55a754&&_0x25dbfd[_0x2491('0x18')]===_0x41fc96||this[_0x2491('0x57')]({'revision':_0x25dbfd,'from':_0x41fc96,'to':_0x55a754}),_0x456368=!0x0),_0x456368&&(delete _0x172fda[_0x2491('0x18')],delete _0x172fda['toVersion'],delete _0x172fda[_0x2491('0x8')],delete _0x172fda[_0x2491('0x2b')],delete _0x172fda[_0x2491('0x3e')]);}this['_revisionTracker'][_0x2491('0x1d')](_0x172fda),this[_0x2491('0x29')](_0x172fda);}else this[_0x2491('0x6')][_0x2491('0x13')](_0x172fda);}const _0x40a33f=_0x36ac61[_0x2491('0x2')]();_0x40a33f[_0x2491('0x14')]();for(let _0x403387=0x0;_0x403387<_0x40a33f['length']-0x1;_0x403387++){const _0x45200c=_0x40a33f[_0x403387],_0x2838c9=_0x40a33f[_0x403387+0x1];if(_0x45200c[_0x2491('0x18')]<_0x2838c9[_0x2491('0x48')]){const _0x286190=_0x2838c9['toVersion'],_0x3e2258=Math['max'](_0x286190,_0x45200c[_0x2491('0x48')]);this[_0x2491('0x57')]({'revision':_0x45200c,'from':_0x286190,'to':_0x3e2258});}}}[_0x2491('0x57')]({revision:_0x34ca67,from:_0x531ded,to:_0x1f399f}={}){const _0x5cd63c=this[_0x2491('0x17')][_0x2491('0x31')][_0x2491('0x27')](_0x3d876d),_0x4a3c1e=this[_0x2491('0x6')]['buildRevisionData']({'revision':_0x34ca67,'from':_0x531ded,'to':_0x1f399f});_0x4a3c1e['authors']=_0x4a3c1e[_0x2491('0x3e')][_0x2491('0x3')](_0xc9671a=>_0x5cd63c[_0x2491('0x4a')](_0xc9671a)),_0x34ca67['_update'](_0x4a3c1e);}[_0x2491('0x29')](_0x1580bf){const _0xb04cb0={};_0xb04cb0['id']=_0x1580bf['id'];for(const _0x47fe16 of Object[_0x2491('0x3d')](_0x1580bf))'id'!==_0x47fe16&&(_0xb04cb0[_0x47fe16]=void 0x0);this[_0x2491('0x6')][_0x2491('0x1')](_0xb04cb0['id'],_0xb04cb0,!0x0);}async['_fetchMissingUsers'](_0x32c1cc){const _0x32b495=this[_0x2491('0x17')][_0x2491('0x31')][_0x2491('0x27')](_0x3d876d),{connection:_0x54fa9e}=this[_0x2491('0x17')]['plugins'][_0x2491('0x27')](_0x3d6823),_0x1f17c6=new Set();for(const _0x4c8e55 of _0x32c1cc){for(const _0xb8f589 of _0x4c8e55['authorsIds'])_0xd616d3(_0xb8f589);_0x4c8e55[_0x2491('0x46')]&&_0xd616d3(_0x4c8e55[_0x2491('0x46')]);}if(0x0===_0x1f17c6['size'])return;const _0x3295df=await _0x109cb3['getMany'](_0x54fa9e,Array[_0x2491('0x4d')](_0x1f17c6));for(const _0x5991cc of _0x3295df)_0x32b495[_0x2491('0x4a')](_0x5991cc['id'])||_0x32b495[_0x2491('0x4f')](_0x5991cc);function _0xd616d3(_0x25fb78){_0x32b495[_0x2491('0x4a')](_0x25fb78)||_0x1f17c6[_0x2491('0x4')](_0x25fb78);}}}function st(_0x10abc2){return _0x10abc2[_0x2491('0x59')][_0x2491('0x54')](_0x2491('0x55'))||_0x10abc2['message'][_0x2491('0x54')]('cloud-services-internal-error:\x20Not\x20connected.')||_0x10abc2[_0x2491('0x59')][_0x2491('0x54')](_0x2491('0x30'));}v['RevisionHistoryService']=_0x13f35d;