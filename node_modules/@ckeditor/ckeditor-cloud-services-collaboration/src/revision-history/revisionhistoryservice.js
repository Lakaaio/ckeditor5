/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4acd29,_0x17a6c9,_0x16414d,_0x412ad3){void 0x0===_0x412ad3&&(_0x412ad3=_0x16414d),Object['defineProperty'](_0x4acd29,_0x412ad3,{'enumerable':!0x0,'get':function(){return _0x17a6c9[_0x16414d];}});}:function(_0x1442fc,_0x46a519,_0x577cd3,_0x22511f){void 0x0===_0x22511f&&(_0x22511f=_0x577cd3),_0x1442fc[_0x22511f]=_0x46a519[_0x577cd3];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x157ad6,_0x557fe1){Object['defineProperty'](_0x157ad6,'default',{'enumerable':!0x0,'value':_0x557fe1});}:function(_0x107d1f,_0x2182fa){_0x107d1f['default']=_0x2182fa;}),__importStar=this&&this['__importStar']||function(_0x3f9433){if(_0x3f9433&&_0x3f9433['__esModule'])return _0x3f9433;var _0x533255={};if(null!=_0x3f9433)for(var _0x2580d6 in _0x3f9433)'default'!==_0x2580d6&&Object['prototype']['hasOwnProperty']['call'](_0x3f9433,_0x2580d6)&&__createBinding(_0x533255,_0x3f9433,_0x2580d6);return __setModuleDefault(_0x533255,_0x3f9433),_0x533255;},__importDefault=this&&this['__importDefault']||function(_0x59cfaa){return _0x59cfaa&&_0x59cfaa['__esModule']?_0x59cfaa:{'default':_0x59cfaa};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),revisionhistorygetrevisionmessage_1=__importDefault(require('./messages/revisionhistorygetrevisionmessage')),revisionhistorygetrevisionresponse_1=__importDefault(require('./responses/revisionhistorygetrevisionresponse')),revisionhistoryupdaterevisionsmessage_1=__importDefault(require('./messages/revisionhistoryupdaterevisionsmessage')),revisionhistoryupdaterevisionsresponse_1=__importDefault(require('./responses/revisionhistoryupdaterevisionsresponse')),revisionhistoryconnectmessage_1=__importDefault(require('./messages/revisionhistoryconnectmessage')),revisionhistoryconnectresponse_1=__importDefault(require('./responses/revisionhistoryconnectresponse')),revisionhistoryreconnectmessage_1=__importDefault(require('./messages/revisionhistoryreconnectmessage')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0xc;class RevisionHistoryService extends(0x0,utils_1['EmitterMixin'])(){constructor(_0x202e07){super(),this['_documentId']=_0x202e07,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x5a54b1){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x5a54b1,new revisionhistoryconnectmessage_1['default'](this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x2550bf,_0x33dcf0){if(this['isConnected'])throw new ckeditorcloudserviceserror_1['default']('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x2550bf);return this['_connect'](_0x2550bf,new revisionhistoryreconnectmessage_1['default'](this['_documentId'],_0x33dcf0));}async['updateRevisions'](_0x347039,_0x2f1127){const _0x49e597=revisionhistoryupdaterevisionsmessage_1['default']['create']({'documentId':this['_documentId'],'requestId':_0x2f1127,'revisions':_0x347039}),_0x1405cf=await this['_sendRequest'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE'],_0x49e597),{requestId:requestId}=messagescompressor_1['default']['decode'](_0x1405cf,revisionhistoryupdaterevisionsresponse_1['default']);return requestId;}async['getRevision'](_0x5d1e7f){const _0x2994b5=new revisionhistorygetrevisionmessage_1['default'](this['_documentId'],_0x5d1e7f),_0x36fa66=await this['_sendRequest'](revisionhistorygetrevisionmessage_1['default']['TYPE'],_0x2994b5);return messagescompressor_1['default']['decode'](_0x36fa66,revisionhistorygetrevisionresponse_1['default'])['toObject']();}async['_connect'](_0x5b539b,_0x27bddf){if(_0x5b539b['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x5b539b);this['_wsGateway']=_0x5b539b,this['stopListening'](_0x5b539b,'change:state');const _0x12e865=await _0x5b539b['_sendRequest'](exports['_SERVICE'],_0x27bddf['constructor']['TYPE'],messagescompressor_1['default']['encode'](_0x27bddf)),{channel:channel,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x12e865,revisionhistoryconnectresponse_1['default'])['toObject']();return this['listenTo'](_0x5b539b,'change:state',(_0x37c4ff,_0xb0387f,_0x4748b2)=>this['_onWsGatewayStateChange'](_0x4748b2),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x5b539b,channel),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':revisions,'requestId':requestId};}['_connectToChannel'](_0x3edbb5,_0x19cc8e){this['_channel']=_0x3edbb5['_getChannel'](RevisionHistoryService['_SERVICE'],_0x19cc8e),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE']),(_0x2abe13,_0x16a7ec)=>{const {documentId:documentId,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x16a7ec,revisionhistoryupdaterevisionsmessage_1['default'])['toObject']();this['fire']('revisionsUpdated',{'documentId':documentId,'requestId':requestId,'revisionsData':revisions});});}['_onWsGatewayStateChange'](_0x157892){_0x157892===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x374b9d,_0x2ce06c){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x374b9d,messagescompressor_1['default']['encode'](_0x2ce06c));}}RevisionHistoryService['_SERVICE']=exports['_SERVICE'],exports['default']=RevisionHistoryService;