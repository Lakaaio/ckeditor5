/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __importDefault=this&&this['__importDefault']||function(_0x3227a2){return _0x3227a2&&_0x3227a2['__esModule']?_0x3227a2:{'default':_0x3227a2};};Object['defineProperty'](exports,'__esModule',{'value':!0x0});const ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror'));class WebSocketRequest{constructor(_0x5b2aa1,_0x1d3d64){this['_context']=_0x5b2aa1,this['_deferredPromise']=function(){let _0x378258,_0x31c687;const _0x3f6faa=new Promise((_0x2b7389,_0x2d6ac3)=>{_0x378258=_0x2b7389,_0x31c687=_0x2d6ac3;});return{'resolve':_0x378258,'reject':_0x31c687,'promise':_0x3f6faa};}(),this['timeout']=setTimeout(()=>this['error'](new ckeditorcloudserviceserror_1['default']('Request\x20timeout.',this['_context'])),_0x1d3d64);}get['promise'](){return this['_deferredPromise']['promise'];}['response'](_0x5108fe){this['_deferredPromise']['resolve'](_0x5108fe);}['error'](_0x1d4fac){this['_deferredPromise']['reject'](_0x1d4fac);}}exports['default']=class{constructor(_0x469761){this['_context']=_0x469761,this['_requests']=new Set();}async['send'](_0x567a05,_0x3d3087=0xafc8){const _0x5dc533=this['_createRequest'](_0x3d3087);try{return _0x567a05(_0x5dc533),await _0x5dc533['promise'];}finally{this['_finishRequest'](_0x5dc533);}}['errorAll'](_0x3c4cb9){for(const _0xfaf21d of this['_requests'])_0xfaf21d['error'](_0x3c4cb9);}['waitForAllRequests'](_0x4a0648=0xafc8){return this['_waitForRequests'](_0x4a0648);}['_createRequest'](_0x54599f){const _0x1dcb79=new WebSocketRequest(this['_context'],_0x54599f);return this['_requests']['add'](_0x1dcb79),_0x1dcb79;}['_finishRequest'](_0x2b195c){this['_requests']['delete'](_0x2b195c),clearTimeout(_0x2b195c['timeout']);}async['_waitForRequests'](_0x241fe3=0x1388,_0x5375e2=0x0){return!this['_requests']['size']||_0x5375e2>=_0x241fe3/0x1f4?Promise['resolve']():(await new Promise(_0x4693bf=>{setTimeout(_0x4693bf,0x1f4);}),this['_waitForRequests'](_0x241fe3,_0x5375e2++));}};