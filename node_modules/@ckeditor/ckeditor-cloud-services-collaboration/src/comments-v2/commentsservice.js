/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x3797eb,_0x3e778e,_0x53aae4,_0x45ac99){void 0x0===_0x45ac99&&(_0x45ac99=_0x53aae4),Object['defineProperty'](_0x3797eb,_0x45ac99,{'enumerable':!0x0,'get':function(){return _0x3e778e[_0x53aae4];}});}:function(_0x1c49a2,_0x3685c8,_0x1ce713,_0x4edb14){void 0x0===_0x4edb14&&(_0x4edb14=_0x1ce713),_0x1c49a2[_0x4edb14]=_0x3685c8[_0x1ce713];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x460fa4,_0x23d9c6){Object['defineProperty'](_0x460fa4,'default',{'enumerable':!0x0,'value':_0x23d9c6});}:function(_0x35d387,_0x55061f){_0x35d387['default']=_0x55061f;}),__importStar=this&&this['__importStar']||function(_0x386a7f){if(_0x386a7f&&_0x386a7f['__esModule'])return _0x386a7f;var _0x5f94c3={};if(null!=_0x386a7f)for(var _0x17db24 in _0x386a7f)'default'!==_0x17db24&&Object['prototype']['hasOwnProperty']['call'](_0x386a7f,_0x17db24)&&__createBinding(_0x5f94c3,_0x386a7f,_0x17db24);return __setModuleDefault(_0x5f94c3,_0x386a7f),_0x5f94c3;},__importDefault=this&&this['__importDefault']||function(_0x2fd384){return _0x2fd384&&_0x2fd384['__esModule']?_0x2fd384:{'default':_0x2fd384};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addcommentmessage_1=__importDefault(require('./messages/addcommentmessage')),addcommentresponse_1=__importDefault(require('./responses/addcommentresponse')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),removecommentmessage_1=__importDefault(require('./messages/removecommentmessage')),removecommentthreadmessage_1=__importDefault(require('./messages/removecommentthreadmessage')),updatecommentmessage_1=__importDefault(require('./messages/updatecommentmessage')),getcommentthreadmessage_1=__importDefault(require('./messages/getcommentthreadmessage')),getcommentthreadresponse_1=__importDefault(require('./responses/getcommentthreadresponse')),getdocumentthreadsmessage_1=__importDefault(require('./messages/getdocumentthreadsmessage')),getdocumentthreadsresponse_1=__importDefault(require('./responses/getdocumentthreadsresponse')),websocketgateway_1=__importStar(require('./../websocketgateway/websocketgateway')),ckeditorcloudserviceserror_1=__importDefault(require('./../ckeditorcloudserviceserror')),sessions_1=__importDefault(require('../sessions/sessions')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError')),ckeditorcloudservicesservererror_1=__importDefault(require('../ckeditorcloudservicesservererror')),addcommentthreadresponse_1=__importDefault(require('./responses/comment-threads/addcommentthreadresponse')),addcommentthreadmessage_1=__importDefault(require('./messages/comment-threads/addcommentthreadmessage')),resolvecommentthreadmessage_1=__importDefault(require('./messages/comment-threads/resolvecommentthreadmessage')),reopencommentthreadmessage_1=__importDefault(require('./messages/comment-threads/reopencommentthreadmessage')),updatecommentthreadmessage_1=__importDefault(require('./messages/comment-threads/updatecommentthreadmessage')),resolvecommentthreadresponse_1=__importDefault(require('./responses/comment-threads/resolvecommentthreadresponse'));exports['_SERVICE']=0x9;class CommentsService extends(0x0,utils_1['EmitterMixin'])(){constructor(_0x55616d){super(),this['_documentId']=_0x55616d,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x534db6){if(this['_isConnected'])return;if(_0x534db6['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x534db6);const _0x5c3238=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x534db6,this['stopListening'](_0x534db6,'change:state');const _0x3675e5=await _0x534db6['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x5c3238)),{channel:channel,threads:threads}=messagescompressor_1['default']['decode'](_0x3675e5,connectresponse_1['default']);return this['listenTo'](_0x534db6,'change:state',(_0x358b8b,_0x121d6c,_0x2d5861)=>this['_onWsGatewayStateChange'](_0x2d5861),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x534db6,channel),this['_isConnected']=!0x0,this['fire']('connected'),threads;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x470f1c,_0x5c916c,_0x48f89d,_0x46707e){const _0x484f5d=new addcommentmessage_1['default'](this['_documentId'],_0x470f1c,_0x48f89d,_0x5c916c,void 0x0,void 0x0,_0x46707e),_0x2cb8cc=await this['_sendRequest'](addcommentmessage_1['default']['TYPE'],_0x484f5d);return messagescompressor_1['default']['decode'](_0x2cb8cc,addcommentresponse_1['default']);}async['updateComment'](_0x2c66b6,_0x3a5d10,_0x1fac2a,_0x2213b5){const _0x535f00=void 0x0!==_0x2213b5,_0x417b37=new updatecommentmessage_1['default'](this['_documentId'],_0x2c66b6,_0x3a5d10,_0x1fac2a,_0x2213b5,_0x535f00);await this['_sendRequest'](updatecommentmessage_1['default']['TYPE'],_0x417b37);}async['removeComment'](_0x22db91,_0x527a24){const _0x10599b=new removecommentmessage_1['default'](this['_documentId'],_0x22db91,_0x527a24);await this['_sendRequest'](removecommentmessage_1['default']['TYPE'],_0x10599b);}async['removeCommentThread'](_0x3e1dcf){const _0x5a13de=new removecommentthreadmessage_1['default'](this['_documentId'],_0x3e1dcf);await this['_sendRequest'](removecommentthreadmessage_1['default']['TYPE'],_0x5a13de);}async['addCommentThread'](_0x28be34){var _0x521b31;const _0x3e918d=new addcommentthreadmessage_1['default'](this['_documentId'],_0x28be34['commentThreadId'],null===(_0x521b31=_0x28be34['comments'])||void 0x0===_0x521b31?void 0x0:_0x521b31['map'](_0x36fa33=>({..._0x36fa33,'documentId':this['_documentId'],'commentThreadId':_0x28be34['commentThreadId']})),_0x28be34['context'],_0x28be34['resolvedBy'],_0x28be34['createdAt'],_0x28be34['resolvedAt'],_0x28be34['deletedAt'],_0x28be34['attributes']),_0x5d73c7=await this['_sendRequest'](addcommentthreadmessage_1['default']['TYPE'],_0x3e918d);return messagescompressor_1['default']['decode'](_0x5d73c7,addcommentthreadresponse_1['default']);}async['resolveCommentThread'](_0x1ca30d){const _0x16a223=new resolvecommentthreadmessage_1['default'](_0x1ca30d,this['_documentId']),_0x354878=await this['_sendRequest'](resolvecommentthreadmessage_1['default']['TYPE'],_0x16a223);return messagescompressor_1['default']['decode'](_0x354878,resolvecommentthreadresponse_1['default']);}async['reopenCommentThread'](_0x325e2c){const _0x20ac79=new reopencommentthreadmessage_1['default'](_0x325e2c,this['_documentId']);await this['_sendRequest'](reopencommentthreadmessage_1['default']['TYPE'],_0x20ac79);}async['updateCommentThread'](_0x21f002){const _0xf83d94=new updatecommentthreadmessage_1['default'](_0x21f002['commentThreadId'],this['_documentId'],_0x21f002['context'],_0x21f002['attributes']);await this['_sendRequest'](updatecommentthreadmessage_1['default']['TYPE'],_0xf83d94);}async['getCommentThread'](_0x42784e,_0x365197=0x1){const _0x7cbf91=new getcommentthreadmessage_1['default'](_0x42784e,this['_documentId']);try{const _0x41968d=await this['_sendRequest'](getcommentthreadmessage_1['default']['TYPE'],_0x7cbf91),_0x562dc9=messagescompressor_1['default']['decode'](_0x41968d,getcommentthreadresponse_1['default']);return{'commentThreadId':_0x562dc9['commentThreadId'],'comments':_0x562dc9['comments'],'attributes':_0x562dc9['attributes'],'context':_0x562dc9['context'],'resolvedAt':_0x562dc9['resolvedAt'],'resolvedBy':_0x562dc9['resolvedBy'],'deletedAt':_0x562dc9['deletedAt']};}catch(_0x33fce9){if('CKEditorCloudServicesServerError'===_0x33fce9['name']&&'404'===_0x33fce9['code']&&_0x365197<0x5)return await(_0x3f486e=0x64*_0x365197,new Promise(_0x4d5108=>{setTimeout(_0x4d5108,_0x3f486e);})),this['getCommentThread'](_0x42784e,_0x365197+0x1);if('CKEditorCloudServicesServerError'===_0x33fce9['name'])throw _0x33fce9;throw ckeditorcloudservicesservererror_1['default']['fromPublicError'](_0x33fce9);}var _0x3f486e;}async['getDocumentThreads'](){const _0x269be4=new getdocumentthreadsmessage_1['default'](this['_documentId']),_0x15738a=await this['_sendRequest'](getdocumentthreadsmessage_1['default']['TYPE'],_0x269be4),{threads:threads}=messagescompressor_1['default']['decode'](_0x15738a,getdocumentthreadsresponse_1['default']);return{'threads':threads};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await sessions_1['default']['getConnectedSessions'](this['_wsGateway'],this['_documentId'],exports['_SERVICE'])),this['_connectedSessions'];}['_connectToChannel'](_0x4b499d,_0x120a5f){this['_channel']=_0x4b499d['_getChannel'](CommentsService['_SERVICE'],_0x120a5f),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](addcommentmessage_1['default']['TYPE']),(_0x5a54a6,_0x472fce)=>{const _0x23c960=messagescompressor_1['default']['decode'](_0x472fce,addcommentmessage_1['default']);this['fire']('commentAdded',_0x23c960);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentmessage_1['default']['TYPE']),(_0xf2c8f7,_0x46bf95)=>{const _0x4b70ce=messagescompressor_1['default']['decode'](_0x46bf95,removecommentmessage_1['default']);this['fire']('commentRemoved',_0x4b70ce);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatecommentmessage_1['default']['TYPE']),(_0x1e3c82,_0x18f419)=>{const _0x53847d=messagescompressor_1['default']['decode'](_0x18f419,updatecommentmessage_1['default']);this['fire']('commentUpdated',_0x53847d);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentthreadmessage_1['default']['TYPE']),(_0x10ee8e,_0x296f28)=>{const _0x373af1=messagescompressor_1['default']['decode'](_0x296f28,removecommentthreadmessage_1['default']);this['fire']('commentThreadRemoved',_0x373af1);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](addcommentthreadmessage_1['default']['TYPE']),(_0x83443a,_0x335e0e)=>{const _0x33b168=messagescompressor_1['default']['decode'](_0x335e0e,addcommentthreadmessage_1['default']);this['fire']('commentThreadAdded',_0x33b168);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatecommentthreadmessage_1['default']['TYPE']),(_0x37bc49,_0xa333ca)=>{const _0xbc1968=messagescompressor_1['default']['decode'](_0xa333ca,updatecommentthreadmessage_1['default']);this['fire']('commentThreadUpdated',_0xbc1968);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](resolvecommentthreadmessage_1['default']['TYPE']),(_0x17e0b8,_0x43564f)=>{const _0x5321a8=messagescompressor_1['default']['decode'](_0x43564f,resolvecommentthreadmessage_1['default']);this['fire']('commentThreadResolved',_0x5321a8);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](reopencommentthreadmessage_1['default']['TYPE']),(_0x5a312a,_0x2228ce)=>{const _0x5edd00=messagescompressor_1['default']['decode'](_0x2228ce,reopencommentthreadmessage_1['default']);this['fire']('commentThreadReopened',_0x5edd00);}));}['_onWsGatewayStateChange'](_0x49f344){_0x49f344===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1ad23a,_0x50b7ad){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x1ad23a,messagescompressor_1['default']['encode'](_0x50b7ad));}}CommentsService['_SERVICE']=exports['_SERVICE'],exports['default']=CommentsService;