/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x4e8670,_0x5312ba,_0x414eb6,_0x306bf0){void 0x0===_0x306bf0&&(_0x306bf0=_0x414eb6),Object['defineProperty'](_0x4e8670,_0x306bf0,{'enumerable':!0x0,'get':function(){return _0x5312ba[_0x414eb6];}});}:function(_0x53fccc,_0x5f2930,_0x214f4,_0x1dbdaf){void 0x0===_0x1dbdaf&&(_0x1dbdaf=_0x214f4),_0x53fccc[_0x1dbdaf]=_0x5f2930[_0x214f4];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x3859af,_0x3b890f){Object['defineProperty'](_0x3859af,'default',{'enumerable':!0x0,'value':_0x3b890f});}:function(_0x4d2ff5,_0x491eb3){_0x4d2ff5['default']=_0x491eb3;}),__importStar=this&&this['__importStar']||function(_0x5ef120){if(_0x5ef120&&_0x5ef120['__esModule'])return _0x5ef120;var _0x4541f9={};if(null!=_0x5ef120)for(var _0xb04f01 in _0x5ef120)'default'!==_0xb04f01&&Object['prototype']['hasOwnProperty']['call'](_0x5ef120,_0xb04f01)&&__createBinding(_0x4541f9,_0x5ef120,_0xb04f01);return __setModuleDefault(_0x4541f9,_0x5ef120),_0x4541f9;},__importDefault=this&&this['__importDefault']||function(_0x196de3){return _0x196de3&&_0x196de3['__esModule']?_0x196de3:{'default':_0x196de3};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addsuggestionmessage_1=__importDefault(require('./messages/addsuggestionmessage')),addsuggestionresponse_1=__importDefault(require('./responses/addsuggestionresponse')),getsuggestionmessage_1=__importDefault(require('./messages/getsuggestionmessage')),getsuggestionresponse_1=__importDefault(require('./responses/getsuggestionresponse')),getallsuggestionsmessage_1=__importDefault(require('./messages/getallsuggestionsmessage')),getallsuggestionsresponse_1=__importDefault(require('./responses/getallsuggestionsresponse')),updatesuggestionmessage_1=__importDefault(require('./messages/updatesuggestionmessage')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError')),ckeditorcloudservicesservererror_1=__importDefault(require('../ckeditorcloudservicesservererror')),batchUpdateSuggestionsStateMessage_1=__importDefault(require('./messages/batchUpdateSuggestionsStateMessage'));exports['_SERVICE']=0xa;class TrackChangesService extends(0x0,utils_1['EmitterMixin'])(){constructor(_0x21fff8){super(),this['_documentId']=_0x21fff8,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x26ed96){if(this['_isConnected'])return;if(_0x26ed96['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x26ed96);const _0x23b29c=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x26ed96,this['stopListening'](_0x26ed96,'change:state');const _0x117705=await _0x26ed96['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x23b29c)),_0x2709fd=messagescompressor_1['default']['decode'](_0x117705,connectresponse_1['default']);return this['listenTo'](_0x26ed96,'change:state',(_0x2194b2,_0x63b7b3,_0x1b3b4a)=>this['_onWsGatewayStateChange'](_0x1b3b4a),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x26ed96,_0x2709fd['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0x2709fd['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x39af05,_0x2ccd3b,_0x22b90b,_0x2ad03d=null,_0x170878){const _0x3e1d0d=new addsuggestionmessage_1['default'](_0x39af05,this['_documentId'],_0x2ccd3b,_0x22b90b,_0x2ad03d,_0x170878),_0x16bc44=await this['_sendRequest'](addsuggestionmessage_1['default']['TYPE'],_0x3e1d0d);return messagescompressor_1['default']['decode'](_0x16bc44,addsuggestionresponse_1['default']);}async['get'](_0x1b497b,_0x4b666f=0x1){const _0x8dc186=new getsuggestionmessage_1['default'](_0x1b497b,this['_documentId']);try{const _0x52cab0=await this['_sendRequest'](getsuggestionmessage_1['default']['TYPE'],_0x8dc186);return messagescompressor_1['default']['decode'](_0x52cab0,getsuggestionresponse_1['default']);}catch(_0x5540d9){if('CKEditorCloudServicesServerError'===_0x5540d9['name']&&'404'===_0x5540d9['code']&&_0x4b666f<0x5)return await(_0x5e1ff6=0x64*_0x4b666f,new Promise(_0x1cb6f2=>{setTimeout(_0x1cb6f2,_0x5e1ff6);})),this['get'](_0x1b497b,_0x4b666f+0x1);if('CKEditorCloudServicesServerError'===_0x5540d9['name'])throw _0x5540d9;throw ckeditorcloudservicesservererror_1['default']['fromPublicError'](_0x5540d9);}var _0x5e1ff6;}async['getAll'](){const _0x4aab03=new getallsuggestionsmessage_1['default'](this['_documentId']),_0x3bbb51=await this['_sendRequest'](getallsuggestionsmessage_1['default']['TYPE'],_0x4aab03),{suggestions:suggestions}=messagescompressor_1['default']['decode'](_0x3bbb51,getallsuggestionsresponse_1['default']);return suggestions;}async['update'](_0x6b502b,_0x10137a={}){const {hasComments:hasComments,state:state,attributes:attributes}=_0x10137a,_0x857d43=void 0x0!==hasComments,_0xd19a02=new updatesuggestionmessage_1['default'](_0x6b502b,this['_documentId'],hasComments,_0x857d43,state,attributes);await this['_sendRequest'](updatesuggestionmessage_1['default']['TYPE'],_0xd19a02);}async['batchUpdateState'](_0x21a08b){const _0x3ebd0d=new batchUpdateSuggestionsStateMessage_1['default'](_0x21a08b['ids'],this['_documentId'],_0x21a08b['state']);await this['_sendRequest'](batchUpdateSuggestionsStateMessage_1['default']['TYPE'],_0x3ebd0d);}['_connectToChannel'](_0x4a4095,_0x4a5854){this['_channel']=_0x4a4095['_getChannel'](TrackChangesService['_SERVICE'],_0x4a5854),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatesuggestionmessage_1['default']['TYPE']),(_0x584c4f,_0x38542a)=>{const _0x1c35ea=messagescompressor_1['default']['decode'](_0x38542a,updatesuggestionmessage_1['default']);this['fire']('suggestionUpdated',_0x1c35ea);});}['_onWsGatewayStateChange'](_0x3aa97a){_0x3aa97a===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1290d5,_0x4cffe7){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x1290d5,messagescompressor_1['default']['encode'](_0x4cffe7));}}TrackChangesService['_SERVICE']=exports['_SERVICE'],exports['default']=TrackChangesService;