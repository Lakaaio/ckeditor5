/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Command as _0x5d9969}from'ckeditor5/src/core';import{Range as _0x46c143}from'ckeditor5/src/engine';import{logWarning as _0xc9d35b,logError as _0x45e29c,first as _0x5cfa4e,uid as _0x4dee65}from'ckeditor5/src/utils';export default class d extends _0x5d9969{constructor(_0x3e5ae){super(_0x3e5ae),this['set']('isBusy',!0x1),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['on']('dataInsert',(_0x2983cf,_0x55533f)=>{const _0x263d0e=new DataTransfer();_0x263d0e['setData']('text/html',_0x55533f['html']);const _0x554840=this['_importMarker']['getRange']();this['editor']['model']['enqueueChange'](this['_undoStepBatch'],_0x2595a6=>{this['_importMarker']['stopListening'](),_0x2595a6['setSelection'](_0x554840),_0x3e5ae['editing']['view']['document']['fire']('clipboardInput',{'dataTransfer':_0x263d0e});});},{'priority':'low'});}['refresh'](){this['isEnabled']=this['_checkEnabled']();}['execute'](_0x42be99,_0xcd0a7d={}){if(this['isBusy'])return Promise['resolve']();const _0x48fb54=this['editor']['config']['get']('importWord'),_0x411a25={'url':_0x48fb54['converterUrl'],'file':_0x42be99,'serviceConfig':{..._0xcd0a7d,'default_styles':_0x48fb54['defaultStyles']}};return this['_prepareForImport'](),this['_sendImportRequest'](_0x411a25)['then'](this['_handleImportResponse']['bind'](this))['catch'](this['_handleImportFailure']['bind'](this))['finally'](this['_cleanUpAfterImport']['bind'](this));}['_checkEnabled'](){if(this['isBusy'])return!0x1;const _0x56337f=this['editor']['model'],_0x1774ca=_0x56337f['schema'],_0x20b4bb=_0x56337f['document']['selection'],_0x2c4f6d=_0x5cfa4e(_0x20b4bb['getSelectedBlocks']());return!!_0x2c4f6d&&_0x1774ca['checkChild'](_0x2c4f6d['parent'],'paragraph');}['_prepareForImport'](){const _0x45d878=this['editor'],_0x4e25e8=_0x45d878['model'],_0x3563ea=_0x4e25e8['document']['selection'];this['_abortController']=new AbortController(),this['_undoStepBatch']=_0x45d878['model']['createBatch']({'isUndoable':!0x0}),_0x4e25e8['enqueueChange'](this['_undoStepBatch'],_0xa0475=>{_0x3563ea['isCollapsed']||_0x4e25e8['deleteContent'](_0x3563ea,{'leaveUnmerged':!0x0});const _0x12b5cc=_0x3563ea['getFirstPosition'](),_0x14ea0c=_0x5cfa4e(_0x3563ea['getSelectedBlocks']());let _0xcb37ec;_0xcb37ec=_0x14ea0c['is']('element','paragraph')&&_0x14ea0c['isEmpty']?_0x12b5cc:_0x12b5cc['isAtStart']?_0x4e25e8['createPositionBefore'](_0x14ea0c):_0x12b5cc['isAtEnd']?_0x4e25e8['createPositionAfter'](_0x14ea0c):_0xa0475['split'](_0x12b5cc)['position'],this['_importMarker']=_0xa0475['addMarker']('importWord:'+_0x4dee65(),{'usingOperation':!0x1,'affectsData':!0x1,'range':new _0x46c143(_0xcb37ec)}),this['_importMarker']['on']('change:range',()=>{'$graveyard'===this['_importMarker']['getRange']()['root']['rootName']&&this['_abortController']['abort']();});}),this['isBusy']=!0x0,this['refresh']();}['_cleanUpAfterImport'](){const _0x1120cd=this['editor']['model'];_0x1120cd['markers']['has'](this['_importMarker'])&&_0x1120cd['enqueueChange'](this['_undoStepBatch'],_0x942567=>{_0x942567['removeMarker'](this['_importMarker']);}),this['_importMarker']=null,this['_undoStepBatch']=null,this['_abortController']=null,this['isBusy']=!0x1,this['refresh']();}['_sendImportRequest']({url:_0x3a9b71,file:_0x4c7f92,serviceConfig:_0x5212d7}){const _0x25c230=this['editor']['plugins']['get']('ImportWordEditing')['getToken'](),_0x4e7a39=new FormData();_0x4e7a39['set']('config',JSON['stringify'](_0x5212d7)),_0x4e7a39['set']('file',_0x4c7f92);const _0x1dfc3b={'method':'POST','headers':{},'body':_0x4e7a39,'signal':this['_abortController']['signal']};return _0x25c230&&(_0x1dfc3b['headers']['Authorization']=_0x25c230['value']),fetch(_0x3a9b71,_0x1dfc3b);}['_handleImportResponse'](_0x5bc800){return _0x5bc800['ok']?_0x5bc800['json']()['then'](_0x90b09e=>{if(!this['editor']['model']['markers']['has'](this['_importMarker']))return;'$graveyard'!==this['_importMarker']['getRange']()['root']['rootName']&&this['fire']('dataInsert',_0x90b09e);}):Promise['reject']();}['_handleImportFailure'](){if(this['_abortController']['signal']['aborted'])return void _0xc9d35b('import-word-plugin-import-cancelled');const _0x4eff77=this['editor'],_0x2f333e=(0x0,_0x4eff77['t'])('An\x20error\x20occurred\x20while\x20importing\x20the\x20Word\x20file.');_0x4eff77['plugins']['get']('Notification')['showWarning'](_0x2f333e),_0x45e29c('import-word-plugin-conversion-failed');}}