/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x197e=['addMarker:','change:isReadOnly','hasDomSelection','newRange','high','ignoreResolvedComments','getCommentThread','_threadToController','scrollToThreadMarker','config','ck-comment-marker--active','change:activeMarker','reconvertMarker','context','getAttribute','substring','dataDowncast','upcast','focus','root','model','comment','differ','fetchCommentThread','destroy','activeMarker','refreshVisibility','isResolved','once','managedUsingOperations','rootName','_detachCommentThread','pluginName','split','item','view','map','add','_threads','set','_hasTargetInContent','_attachMarkerToThread','_getTargetForId','consume','ck-comment-marker','editor','isCollapsed','push','reopenCommentThread','addCommentThread','markerToData','low','markers','change','createElement','affectsData','get','$marker','_handleMarkerAddAndRemove','hasContent','_attachedThreads','data','setContext','updateMarker','openNewCommentThread','text','conversion','start','registerAnnotation','switchReadOnly','collaboration.channelId','$graveyard','has','filter','addComment','CommentsEditing','getAllMarkersForId','removeMarker:','_handleThreadMarker','schema','length','reopen','$textProxy','removeMarker','plugins','document','editing','includes','then','destroyed','listenTo','_getTextContext','for','_reconvertMarkers','markerName','getChangedMarkers','attachTo','from','render','change:isThreadsLoadingPaused','hasCommentThread','getWalker','enqueueChange','getItems','state','elementToElement','delete','editingDowncast','isObject','dataToMarker','isEqual','isThreadsLoadingPaused','isLocal','requires','commands','consumable'];(function(_0x3033d5,_0x197e2b){const _0x315e54=function(_0x14cf6f){while(--_0x14cf6f){_0x3033d5['push'](_0x3033d5['shift']());}};_0x315e54(++_0x197e2b);}(_0x197e,0x12e));const _0x315e=function(_0x3033d5,_0x197e2b){_0x3033d5=_0x3033d5-0x0;let _0x315e54=_0x197e[_0x3033d5];return _0x315e54;};import{Plugin as _0x53d941}from'ckeditor5/src/core';import{scrollViewportToShowTarget as _0x916f02}from'ckeditor5/src/utils';import _0x543420 from'./commentsrepository';import _0x1e6d09 from'./addcommentthreadcommand';import{getAllMarkersDomElementsSorted as _0x4111b3}from'ckeditor5-collaboration/src/collaboration-core';import _0x1f94fa from'../annotations/editorannotations';import _0x1ef5c2 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';import _0x8269a from'./integrations/importword';import _0xbcf6c1 from'../annotations/annotations';export default class r extends _0x53d941{static get[_0x315e('0x2b')](){return[_0x543420,_0x1f94fa,_0x1ef5c2,_0x8269a];}static get[_0x315e('0x4e')](){return _0x315e('0x5');}constructor(_0x1f429b){super(_0x1f429b),this[_0x315e('0x55')]('isThreadsLoadingPaused',!0x0),_0x1f429b[_0x315e('0x6b')][_0x315e('0x4a')]('ready',()=>this['isThreadsLoadingPaused']=!0x1),this[_0x315e('0x55')](_0x315e('0x47'),null),this['on'](_0x315e('0x39'),(_0x1ff66b,_0xf2facb,_0x5c6d95,_0x3400a9)=>{const _0x3c8848=_0x5c6d95?tt(_0x5c6d95)['id']:null;if(_0x1f429b[_0x315e('0x42')][_0x315e('0x63')](()=>{if(_0x3c8848){const _0x33e9a8=this[_0x315e('0x6')](_0x3c8848);for(const _0x44703e of _0x33e9a8)_0x1f429b[_0x315e('0x10')]['reconvertMarker'](_0x44703e);}if(_0x3400a9){const {id:_0x2d72aa}=tt(_0x3400a9),_0x150174=this[_0x315e('0x6')](_0x2d72aa);for(const _0x3395b7 of _0x150174)_0x1f429b[_0x315e('0x10')][_0x315e('0x3a')](_0x3395b7);}}),_0x3c8848){const _0x32cde1=_0x1f429b[_0x315e('0xe')][_0x315e('0x66')](_0x543420)[_0x315e('0x34')](_0x3c8848);_0x32cde1&&_0x32cde1[_0x315e('0x49')]&&this[_0x315e('0x36')](_0x3c8848);}}),this[_0x315e('0x6a')]=new Map();}['init'](){const _0xb2876f=this[_0x315e('0x5b')],_0x408382=_0xb2876f[_0x315e('0xe')]['get'](_0x543420),_0x944476=_0xb2876f[_0x315e('0x37')]['get'](_0x315e('0x0'));_0xb2876f[_0x315e('0x2c')]['add'](_0x315e('0x5f'),new _0x1e6d09(_0xb2876f)),this[_0x315e('0x14')](_0xb2876f,_0x315e('0x2f'),(_0xd9f037,_0x5d1ae5,_0x15ae30)=>{_0x408382[_0x315e('0x73')](_0x15ae30,_0xb2876f[_0x315e('0x37')][_0x315e('0x66')](_0x315e('0x0')));}),this['listenTo'](_0x408382,Z('addCommentThread',_0x944476),(_0x119b6a,{threadId:_0x26d78e})=>{const _0x349d1a=_0xb2876f[_0x315e('0xe')][_0x315e('0x66')](_0x1f94fa),_0xe5eac9=this[_0x315e('0x5b')]['plugins'][_0x315e('0x66')](_0x543420)[_0x315e('0x34')](_0x26d78e);if(_0xe5eac9&&_0xe5eac9[_0x315e('0x49')]&&!this['_attachedThreads']['has'](_0x26d78e)){const _0x3b58de=_0xe5eac9[_0x315e('0x1a')](()=>this[_0x315e('0x58')](_0xe5eac9['id']));_0x349d1a[_0x315e('0x72')](_0x3b58de),this[_0x315e('0x6a')][_0x315e('0x55')](_0x26d78e,[]),0x0===this['getAllMarkersForId'](_0x26d78e)[_0x315e('0xa')]&&(_0xe5eac9[_0x315e('0x56')]=!0x1);}}),this[_0x315e('0x14')](_0x408382,Z('removeCommentThread',_0x944476),(_0x504a44,{threadId:_0x376e15})=>{_0xb2876f[_0x315e('0x42')]['enqueueChange']({'isUndoable':!0x1},_0x3f1843=>{const _0x5e15dd=this['getAllMarkersForId'](_0x376e15);this[_0x315e('0x6a')][_0x315e('0x24')](_0x376e15);for(const _0x4fab15 of _0x5e15dd)_0x3f1843[_0x315e('0xd')](_0x4fab15);});},{'priority':_0x315e('0x32')}),this[_0x315e('0x14')](_0x408382,Z('resolveCommentThread',_0x944476),(_0x130207,{threadId:_0x7a0fa4})=>{this['_reconvertMarkers'](_0x7a0fa4),this[_0x315e('0x5b')]['editing'][_0x315e('0x51')][_0x315e('0x30')]&&this[_0x315e('0x5b')][_0x315e('0x10')][_0x315e('0x51')][_0x315e('0x40')]();},{'priority':'low'}),this[_0x315e('0x14')](_0x408382,Z(_0x315e('0x5e'),_0x944476),(_0x450ef7,{threadId:_0x1c43b1})=>{this[_0x315e('0x17')](_0x1c43b1);},{'priority':_0x315e('0x61')}),this[_0x315e('0x14')](_0x408382,Z(_0x315e('0x4'),_0x944476),(_0x5aa108,{threadId:_0x3f9fa1,isFromAdapter:_0x34f415})=>{const _0x15f13f=this[_0x315e('0x6')](_0x3f9fa1);if(_0x34f415||0x0==_0x15f13f[_0x315e('0xa')]||!_0x408382[_0x315e('0x1e')](_0x3f9fa1))return;0x1===_0x408382[_0x315e('0x34')](_0x3f9fa1)[_0x315e('0xa')]&&_0xb2876f[_0x315e('0x42')][_0x315e('0x20')]({'isUndoable':!0x1},_0x34b6e6=>{for(const _0x5e382b of _0x15f13f)_0x34b6e6['updateMarker'](_0x5e382b,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x315e('0x61')}),this['_initializeMarkerConverters'](),this['_handleMarkerAddAndRemove']();}[_0x315e('0x46')](){const _0x109295=this['editor'][_0x315e('0xe')][_0x315e('0x66')](_0x543420),_0x545897=this[_0x315e('0x5b')][_0x315e('0x37')][_0x315e('0x66')](_0x315e('0x0'));for(const _0x16d98b of _0x109295['getCommentThreads']({'channelId':_0x545897}))_0x109295[_0x315e('0x4d')](_0x16d98b['id']),_0x109295[_0x315e('0x54')][_0x315e('0x24')](_0x16d98b['id']);super[_0x315e('0x46')]();}['hasMarkerForId'](_0xe47c83){return this[_0x315e('0x6')](_0xe47c83)[_0x315e('0xa')]>0x0;}['getAllMarkersForId'](_0x3d772e){return(this['_attachedThreads'][_0x315e('0x66')](_0x3d772e)||[])[_0x315e('0x52')](_0x3e6b21=>this['editor']['model'][_0x315e('0x62')][_0x315e('0x66')](_0x3e6b21))[_0x315e('0x3')](_0x3438c4=>_0x3438c4);}['scrollToThreadMarker'](_0x23eef6){const _0x59a801=this[_0x315e('0x58')](_0x23eef6);_0x59a801&&setTimeout(()=>{this[_0x315e('0x47')]&&tt(this[_0x315e('0x47')])['id']===_0x23eef6&&_0x916f02({'target':_0x59a801[0x0],'viewportOffset':0x64,'alignToTop':!0x0});},0x32);}['_reconvertMarkers'](_0x1041f2){this[_0x315e('0x5b')][_0x315e('0x42')][_0x315e('0x63')](()=>{for(const _0x345469 of this[_0x315e('0x6')](_0x1041f2))this['editor'][_0x315e('0x10')]['reconvertMarker'](_0x345469);});}['_initializeMarkerConverters'](){const _0x182fe8=this[_0x315e('0x5b')];_0x182fe8[_0x315e('0x70')][_0x315e('0x16')](_0x315e('0x25'))['markerToHighlight']({'model':_0x315e('0x43'),'view':(_0x3b5874,_0x477cdf)=>{const {id:_0x16a386}=tt(_0x3b5874[_0x315e('0x18')]),_0x4871a9=_0x182fe8[_0x315e('0xe')]['get'](_0x543420)[_0x315e('0x34')](_0x16a386),_0x40a458=this[_0x315e('0x47')]&&tt(this[_0x315e('0x47')])['id']===_0x16a386;if(_0x4871a9&&_0x4871a9[_0x315e('0x49')]&&!_0x40a458&&_0x3b5874[_0x315e('0x50')])return _0x477cdf[_0x315e('0x2d')][_0x315e('0x59')](_0x3b5874[_0x315e('0x50')],_0x315e('0x2e')+_0x3b5874[_0x315e('0x18')]),_0x477cdf[_0x315e('0x2d')][_0x315e('0x59')](_0x3b5874[_0x315e('0x50')],_0x315e('0x7')+_0x3b5874[_0x315e('0x18')]),{'classes':[]};const _0x50f024=[_0x315e('0x5a')];return _0x40a458&&_0x50f024[_0x315e('0x5d')](_0x315e('0x38')),{'classes':_0x50f024,'attributes':{'data-comment':_0x16a386}};}}),_0x182fe8[_0x315e('0x70')][_0x315e('0x16')](_0x315e('0x3e'))[_0x315e('0x60')]({'model':_0x315e('0x43'),'view':(_0x503120,{options:_0x5a3ce1})=>{const _0x2ec688=_0x182fe8['plugins'][_0x315e('0x66')](_0x543420),_0x87239e=_0x182fe8[_0x315e('0x42')][_0x315e('0x62')][_0x315e('0x66')](_0x503120),{id:_0x1c4b85,part:_0x3f19ba}=tt(_0x503120),_0x125a53=_0x2ec688[_0x315e('0x34')](_0x1c4b85);return _0x87239e&&!_0x87239e[_0x315e('0x65')]||_0x125a53&&_0x125a53['isResolved']&&_0x5a3ce1[_0x315e('0x33')]?null:{'group':_0x315e('0x43'),'name':_0x3f19ba?_0x1c4b85+':'+_0x3f19ba:_0x1c4b85};}}),_0x182fe8[_0x315e('0x70')][_0x315e('0x16')](_0x315e('0x3f'))[_0x315e('0x23')]({'view':{'name':_0x315e('0x43'),'attributes':{'id':/^\w/}},'model':(_0x2be808,{writer:_0x40b190})=>_0x40b190[_0x315e('0x64')](_0x315e('0x67'),{'data-name':'comment:'+_0x2be808[_0x315e('0x3c')]('id')})}),_0x182fe8['conversion']['for'](_0x315e('0x3f'))[_0x315e('0x27')]({'view':_0x315e('0x43')});}[_0x315e('0x68')](){const _0x180cd9=this[_0x315e('0x5b')],_0x327ea0=_0x180cd9[_0x315e('0xe')][_0x315e('0x66')](_0x543420),_0x50c2d0=new Set();_0x180cd9['model'][_0x315e('0xf')]['registerPostFixer'](_0x537f63=>{let _0x28724e=!0x1;for(const {name:_0x52c115,data:_0x24ca57}of _0x180cd9[_0x315e('0x42')]['document'][_0x315e('0x44')][_0x315e('0x19')]()){const {group:_0x162d7e,id:_0x4cd8b0}=tt(_0x52c115);let _0x195dc5=_0x24ca57[_0x315e('0x31')];if(_0x315e('0x43')!==_0x162d7e||!_0x195dc5)continue;const _0x577365=_0x315e('0x1')===_0x195dc5[_0x315e('0x41')][_0x315e('0x4c')];_0x577365||(_0x195dc5=ot(_0x195dc5,_0x180cd9[_0x315e('0x42')]),!_0x195dc5||!_0x24ca57[_0x315e('0x31')]||_0x195dc5[_0x315e('0x28')](_0x24ca57[_0x315e('0x31')]))?!_0x195dc5||!_0x180cd9[_0x315e('0x42')][_0x315e('0x69')](_0x195dc5)||this[_0x315e('0x6a')][_0x315e('0x2')](_0x4cd8b0)&&_0x577365?(_0x537f63[_0x315e('0xd')](_0x52c115),_0x28724e=!0x0):_0x577365||(this[_0x315e('0x29')]?_0x50c2d0[_0x315e('0x53')](_0x52c115):this[_0x315e('0x8')](_0x52c115,_0x4cd8b0)):(_0x537f63[_0x315e('0x6d')](_0x52c115,{'range':_0x195dc5}),_0x28724e=!0x0);}return _0x28724e;}),this['on'](_0x315e('0x1d'),(_0x42e82e,_0x41f3fa,_0x1fda70)=>{if(!_0x1fda70&&_0x50c2d0['size'])for(const _0x4e4434 of _0x50c2d0){const {id:_0x5e0d3e}=tt(_0x4e4434);_0x50c2d0[_0x315e('0x24')](_0x5e0d3e),_0x180cd9[_0x315e('0x42')][_0x315e('0x62')]['get'](_0x4e4434)&&this['_handleThreadMarker'](_0x4e4434,_0x5e0d3e);}}),this[_0x315e('0x14')](_0x180cd9['model'][_0x315e('0xf')],_0x315e('0x63'),(_0x50fec8,_0x401915)=>{for(const {name:_0x15ff56,data:{newRange:_0x1b2f40}}of _0x180cd9[_0x315e('0x42')][_0x315e('0xf')][_0x315e('0x44')][_0x315e('0x19')]()){const {group:_0x1554cc,id:_0x30dcba}=tt(_0x15ff56);if(_0x315e('0x43')!==_0x1554cc)continue;const _0x5b25f8=_0x327ea0[_0x315e('0x34')](_0x30dcba),_0x4d48f1=this['hasMarkerForId'](_0x30dcba);_0x5b25f8&&(_0x5b25f8[_0x315e('0x56')]||_0x180cd9[_0x315e('0x10')][_0x315e('0x51')][_0x315e('0x4a')](_0x315e('0x1c'),()=>{const _0xb7f728=_0x180cd9['plugins'][_0x315e('0x66')](_0xbcf6c1),_0x25d5d9=_0x327ea0[_0x315e('0x35')][_0x315e('0x66')](_0x5b25f8)[_0x315e('0x51')];_0xb7f728['getByInnerView'](_0x25d5d9)[_0x315e('0x48')]();},{'priority':_0x315e('0x61')}),_0x5b25f8[_0x315e('0x56')]=_0x4d48f1||!!_0x1b2f40),!_0x1b2f40&&_0x401915[_0x315e('0x2a')]&&(_0x50c2d0[_0x315e('0x24')](_0x30dcba),_0x5b25f8&&!_0x5b25f8['isResolved']&&!_0x4d48f1&&this['_attachedThreads'][_0x315e('0x2')](_0x30dcba)&&(this['_attachedThreads'][_0x315e('0x24')](_0x30dcba),_0x5b25f8['resolve']()));}});}[_0x315e('0x58')](_0x2484fa){const _0x84c838=this[_0x315e('0x5b')],_0x5cf9d4=this['getAllMarkersForId'](_0x2484fa);return _0x4111b3(_0x84c838[_0x315e('0x10')],_0x5cf9d4);}[_0x315e('0x15')](_0x380bd1){const _0x3952f4=this[_0x315e('0x6')](_0x380bd1);let _0x4d9a73='',_0x14f8d0=!0x1;for(const _0x45aca0 of _0x3952f4){const _0x5afc25=_0x45aca0['getRange']();for(const _0x56534f of Array[_0x315e('0x1b')](_0x5afc25[_0x315e('0x21')]()))_0x56534f['is'](_0x315e('0xc'))?(_0x4d9a73&&_0x14f8d0&&(_0x4d9a73+='\x20',_0x14f8d0=!0x1),_0x4d9a73+=_0x56534f[_0x315e('0x6b')]):_0x14f8d0=!0x0;_0x14f8d0=!0x0;}return _0x4d9a73[_0x315e('0x3d')](0x0,0x96);}[_0x315e('0x57')](_0x1998dc,_0x3a98d8){const _0x2cce18=this['editor'],_0x5d9809=_0x2cce18[_0x315e('0xe')][_0x315e('0x66')](_0x543420);let _0x2e9a93=_0x5d9809['getCommentThread'](_0x3a98d8);if(this[_0x315e('0x6a')]['has'](_0x3a98d8)){const _0x52faeb=this['_attachedThreads'][_0x315e('0x66')](_0x3a98d8);return _0x52faeb[_0x315e('0x11')](_0x1998dc)||_0x52faeb[_0x315e('0x5d')](_0x1998dc),_0x2e9a93;}this[_0x315e('0x6a')][_0x315e('0x55')](_0x3a98d8,[_0x1998dc]);const _0x3237bc=_0x2cce18['config']['get']('collaboration.channelId'),_0x3387cb=_0x2cce18[_0x315e('0xe')]['get'](_0x1f94fa);if(_0x2e9a93&&_0x2e9a93['isResolved'])return _0x2e9a93[_0x315e('0xb')](),_0x2e9a93;return!this['getAllMarkersForId'](_0x3a98d8)[0x0][_0x315e('0x4b')]?_0x2cce18[_0x315e('0x10')][_0x315e('0x51')]['once'](_0x315e('0x1c'),()=>{const _0x5028a4=_0x2cce18['plugins'][_0x315e('0x66')](_0xbcf6c1);_0x2e9a93=_0x5d9809[_0x315e('0x6e')]({'channelId':_0x3237bc,'threadId':_0x3a98d8,'target':()=>this['_getTargetForId'](_0x3a98d8),'context':{'type':_0x315e('0x6f'),'value':this[_0x315e('0x15')](_0x3a98d8)}});const _0x26e9f2=_0x5d9809[_0x315e('0x35')][_0x315e('0x66')](_0x2e9a93)[_0x315e('0x51')],_0xaa4862=_0x5028a4['getByInnerView'](_0x26e9f2);_0xaa4862&&_0x3387cb[_0x315e('0x72')](_0xaa4862);},{'priority':'low'}):_0x5d9809[_0x315e('0x45')]({'channelId':_0x3237bc,'threadId':_0x3a98d8})[_0x315e('0x12')](_0x48f817=>{if(_0x315e('0x13')!==_0x2cce18[_0x315e('0x22')]){if(_0x2e9a93=_0x48f817,_0x2e9a93){const _0x2d8036=_0x2e9a93[_0x315e('0x1a')](()=>this[_0x315e('0x58')](_0x3a98d8));_0x3387cb[_0x315e('0x72')](_0x2d8036);}else{const _0x24840e=this['getAllMarkersForId'](_0x3a98d8);_0x2cce18[_0x315e('0x42')][_0x315e('0x63')](_0x40b267=>{for(const _0x2d1615 of _0x24840e)_0x40b267['removeMarker'](_0x2d1615);});}}}),_0x2e9a93;}[_0x315e('0x8')](_0xa9a58a,_0x14290d){const _0x2bc68d=this[_0x315e('0x57')](_0xa9a58a,_0x14290d);_0x2bc68d&&!_0x2bc68d[_0x315e('0x3b')]&&_0x2bc68d[_0x315e('0x6c')]({'type':_0x315e('0x6f'),'value':this[_0x315e('0x15')](_0x14290d)});}}function Z(_0x2cdb04,_0x572dfd){return _0x572dfd?_0x2cdb04+':'+_0x572dfd:_0x2cdb04;}function tt(_0x1ce2f0){const _0x4bea75=_0x1ce2f0[_0x315e('0x4f')](':');return{'group':_0x4bea75[0x0],'id':_0x4bea75[0x1],'part':_0x4bea75[0x2]};}function ot(_0x3317cd,_0x591b3b){const _0x3f93f6=_0x591b3b[_0x315e('0x9')],_0x18af28=_0x591b3b['createRange'](_0x3317cd[_0x315e('0x71')]);for(const _0x10d8be of _0x3317cd[_0x315e('0x1f')]()){const {type:_0x19e44f,item:_0x1e583b,nextPosition:_0x3f9541}=_0x10d8be;if('text'===_0x19e44f||_0x3f93f6[_0x315e('0x26')](_0x1e583b)){const _0x3dc3b9=_0x591b3b['createPositionBefore'](_0x1e583b);_0x18af28[_0x315e('0x5c')]&&(_0x18af28['start']=_0x3dc3b9),_0x18af28['end']=_0x3f9541;}}return _0x18af28[_0x315e('0x5c')]?null:_0x18af28;}