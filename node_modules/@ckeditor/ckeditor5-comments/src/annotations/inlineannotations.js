/*
 *             Copyright (c) 2016 - 2023, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x64d0=['includes','width','_manuallyClosed','focus','from','editing','activeAnnotation','find','change:height','showStack','plugins','updatePosition','view','right','_setSelectedAnnotations','setActiveAnnotation','get','detach','annotations','fromRect','getFirstRange','focusTracker','push','getOrderedSelectedAnnotations','register','inlineannotations-attach-already-attached','_removeAnnotationFromBalloon','context','refresh','top','blur','hasActive','pluginName','switchTo','clear','_forceRefresh','length','getClientRects','every','set','visibleView','_getBalloonTargetForAnnotation','attach','requires','inlineannotations-detach-not-attached','keystrokes','Esc','_balloon','targetRect','inline','getByView','_addAnnotationToBalloon','isFocused','_addedAnnotations','change:visibleView','change:isFocused','left','bottom','_closeAnnotation','domConverter','editableElement','addObserver','isActive','mousedown','has','remove','update','init','_selectedAnnotations','selection','destroy','editor','document','stopListening','isAttached','hasView','listenTo','add'];(function(_0x566600,_0x64d016){const _0x15539a=function(_0x4fd0d0){while(--_0x4fd0d0){_0x566600['push'](_0x566600['shift']());}};_0x15539a(++_0x64d016);}(_0x64d0,0x1cf));const _0x1553=function(_0x566600,_0x64d016){_0x566600=_0x566600-0x0;let _0x15539a=_0x64d0[_0x566600];return _0x15539a;};import{Plugin as _0x4fbe3d}from'ckeditor5/src/core';import _0x29bdec from'./annotationsuis';import _0x100ede from'./editorannotations';import{ContextualBalloon as _0x352248}from'ckeditor5/src/ui';import{MouseObserver as _0x4f381a}from'ckeditor5/src/engine';import{CKEditorError as _0x516440,Rect as _0x1ff70d}from'ckeditor5/src/utils';import'./../../theme/annotation-inline.css';export default class c extends _0x4fbe3d{static get[_0x1553('0x30')](){return[_0x100ede,_0x352248,_0x29bdec];}static get[_0x1553('0x25')](){return'InlineAnnotations';}constructor(_0xed133b){super(_0xed133b),_0xed133b[_0x1553('0xa')][_0x1553('0x11')][_0x1553('0x42')](_0x4f381a),this[_0x1553('0x1')]=!0x1,this[_0x1553('0x2c')](_0x1553('0xb'),null),this['annotations']=null,this[_0x1553('0x7')]=new Set(),this[_0x1553('0x34')]=_0xed133b['plugins']['get'](_0x352248),this[_0x1553('0x3a')]=new Set(),this[_0x1553('0x49')]=[],this[_0x1553('0x28')]=!0x1;}[_0x1553('0x48')](){const _0x457c98=this[_0x1553('0x4c')][_0x1553('0xf')]['get'](_0x29bdec);_0x457c98[_0x1553('0x20')]===this[_0x1553('0x4c')]&&(_0x457c98[_0x1553('0x1d')]('inline',this),this[_0x1553('0x4c')][_0x1553('0x32')][_0x1553('0x2c')](_0x1553('0x33'),(_0x1663c6,_0x4677e0)=>{const _0x5bd175=this[_0x1553('0x34')];if(this['isAttached']&&_0x5bd175[_0x1553('0x2d')]){const _0x49c8de=this[_0x1553('0x17')][_0x1553('0x37')](_0x5bd175[_0x1553('0x2d')]);_0x49c8de&&this[_0x1553('0x3f')](_0x49c8de),_0x4677e0();}}));}['afterInit'](){const _0x512790=this['editor'][_0x1553('0xf')][_0x1553('0x15')](_0x29bdec);_0x512790['context']===this[_0x1553('0x4c')]&&(_0x512790[_0x1553('0x24')]()||_0x512790[_0x1553('0x26')](_0x1553('0x36')));}[_0x1553('0x14')](_0x43ed92){_0x43ed92!==this[_0x1553('0xb')]&&(this[_0x1553('0xb')]&&(this[_0x1553('0xb')][_0x1553('0x43')]=!0x1),_0x43ed92&&this[_0x1553('0x4c')]['ui'][_0x1553('0x1a')][_0x1553('0x39')]&&(this[_0x1553('0x17')][_0x1553('0x45')](_0x43ed92)&&this['_addAnnotationToBalloon'](_0x43ed92,!0x0),_0x43ed92[_0x1553('0x43')]=!0x0),_0x43ed92||this[_0x1553('0x13')]([]),this['activeAnnotation']=_0x43ed92);}[_0x1553('0x2f')](_0x5372e6){this['annotations']=_0x5372e6;const _0x378207=this[_0x1553('0x4c')][_0x1553('0xf')]['get'](_0x29bdec),_0x42d498=this[_0x1553('0x34')];if(this['isAttached'])throw new _0x516440(_0x1553('0x1e'),this);if(_0x378207[_0x1553('0x20')]!==this[_0x1553('0x4c')])throw new _0x516440('inlineannotations-not-allowed-with-context',this);const _0x3898a2=this[_0x1553('0x4c')][_0x1553('0xf')][_0x1553('0x15')](_0x100ede);this[_0x1553('0x3')](_0x3898a2,_0x1553('0x21'),()=>{const _0x8b4a4c=_0x3898a2[_0x1553('0x1c')]({'annotations':this['annotations'],'activeAnnotation':this[_0x1553('0xb')]});var _0x3cc322,_0x276467;!this[_0x1553('0x28')]&&(_0x3cc322=_0x8b4a4c,_0x276467=this['_selectedAnnotations'],_0x3cc322[_0x1553('0x29')]===_0x276467[_0x1553('0x29')]&&_0x3cc322[_0x1553('0x2b')](_0x607b5d=>_0x276467[_0x1553('0x5')](_0x607b5d)))||(this[_0x1553('0x28')]=!0x1,this[_0x1553('0x13')](_0x8b4a4c),this[_0x1553('0x14')](_0x8b4a4c[0x0]||null));}),this[_0x1553('0x3')](_0x3898a2,_0x1553('0x23'),(_0x3ad45d,{isAnnotationTracked:_0x14ad7a})=>{this[_0x1553('0xb')]&&_0x14ad7a(this[_0x1553('0xb')])&&(this['_setSelectedAnnotations']([]),this[_0x1553('0x14')](null));}),this['listenTo'](this[_0x1553('0x4c')]['ui']['focusTracker'],_0x1553('0x3c'),(_0x443948,_0x31a11e,_0x379316)=>{_0x379316||this[_0x1553('0x14')](null);}),this[_0x1553('0x3')](_0x5372e6,_0x1553('0x46'),(_0x556bfe,_0x5e1692)=>{this[_0x1553('0x1f')](_0x5e1692),_0x5e1692===this[_0x1553('0xb')]&&this[_0x1553('0x14')](null);}),this[_0x1553('0x3')](_0x42d498,_0x1553('0x3b'),(_0x24d831,_0xce3574,_0x4e5dc6,_0xfbe833)=>{_0xfbe833&&this[_0x1553('0x0')](_0xfbe833);const _0x3dd46d=_0x5372e6['getByView'](_0x4e5dc6);_0x4e5dc6&&_0x3dd46d&&(this['listenTo'](_0x4e5dc6,_0x1553('0xd'),()=>{_0x42d498[_0x1553('0x10')]();}),this[_0x1553('0x3')](_0x4e5dc6,_0x1553('0x33'),()=>{this[_0x1553('0x3f')](_0x3dd46d),this['editor'][_0x1553('0xa')]['view'][_0x1553('0x8')]();}),this['activeAnnotation']!==_0x3dd46d&&this[_0x1553('0x14')](_0x3dd46d));}),this['listenTo'](this[_0x1553('0x4c')]['ui'],_0x1553('0x47'),()=>{_0x42d498['visibleView']&&(_0x5372e6[_0x1553('0x37')](_0x42d498[_0x1553('0x2d')])&&_0x42d498[_0x1553('0x10')]());}),this[_0x1553('0x3')](this[_0x1553('0x4c')][_0x1553('0xa')][_0x1553('0x11')][_0x1553('0x4d')],_0x1553('0x44'),()=>{this[_0x1553('0x28')]=!0x0,this[_0x1553('0x7')][_0x1553('0x27')]();}),this['editor'][_0x1553('0xa')][_0x1553('0x11')][_0x1553('0x4d')]['selection'][_0x1553('0x41')]&&this[_0x1553('0x4c')][_0x1553('0xa')]['view'][_0x1553('0x8')](),this[_0x1553('0x1')]=!0x0;}[_0x1553('0x16')](){if(!this['isAttached'])throw new _0x516440(_0x1553('0x31'),this);this[_0x1553('0x14')](null);for(const _0x175b06 of this['_addedAnnotations'])this[_0x1553('0x1f')](_0x175b06);this[_0x1553('0x0')](),this[_0x1553('0x1')]=!0x1,this[_0x1553('0x17')]=null;}[_0x1553('0x4b')](){this['isAttached']&&this[_0x1553('0x16')]();}[_0x1553('0x13')](_0x4cb34c){for(const _0x1421d3 of this['_selectedAnnotations'])_0x4cb34c[_0x1553('0x5')](_0x1421d3)||this[_0x1553('0x7')]['delete'](_0x1421d3);for(const _0x754a67 of this['annotations'])_0x4cb34c[_0x1553('0x5')](_0x754a67)||this[_0x1553('0x1f')](_0x754a67);if(this[_0x1553('0x4c')]['ui'][_0x1553('0x1a')][_0x1553('0x39')])for(const _0x3280cd of _0x4cb34c)this['_addAnnotationToBalloon'](_0x3280cd);this['_selectedAnnotations']=_0x4cb34c;}[_0x1553('0x38')](_0x2247f1,_0x565359=!0x1){this[_0x1553('0x7')]['has'](_0x2247f1)||(this[_0x1553('0x3a')][_0x1553('0x45')](_0x2247f1)||this['_balloon'][_0x1553('0x2')](_0x2247f1['view'])||(this[_0x1553('0x3a')][_0x1553('0x4')](_0x2247f1),this[_0x1553('0x34')]['add']({'stackId':_0x2247f1[_0x1553('0x11')]['id'],'view':_0x2247f1['view'],'position':{'target':()=>this[_0x1553('0x2e')](_0x2247f1)}})),_0x565359&&this['_balloon'][_0x1553('0xe')](_0x2247f1[_0x1553('0x11')]['id']));}[_0x1553('0x2e')](_0x3c787d){const _0x4956b7=_0x3c787d['target'],_0xf8dfe=this[_0x1553('0x4c')]['editing']['view'],_0x302e6c=_0xf8dfe[_0x1553('0x4d')][_0x1553('0x4a')][_0x1553('0x19')](),_0x21564c=_0xf8dfe[_0x1553('0x40')]['viewRangeToDom'](_0x302e6c);if(_0x21564c['collapse'](!0x0),_0x4956b7){if(_0x4956b7 instanceof _0x1ff70d)return _0x4956b7;let _0x1ef4e7=[];for(const _0xa3fadf of _0x4956b7)_0x1ef4e7[_0x1553('0x1b')](...(_0x8eca6f=_0xa3fadf[_0x1553('0x2a')](),Array[_0x1553('0x9')](_0x8eca6f)['map'](DOMRect[_0x1553('0x18')])));_0x1ef4e7=function(_0x578593){const _0xe61c57=[];let _0x1090e9=_0x578593[0x0];for(let _0x5c75a6=0x1;_0x5c75a6<_0x578593[_0x1553('0x29')];_0x5c75a6++)F(_0x1090e9,_0x578593[_0x5c75a6])?_0x1090e9['width']+=_0x578593[_0x5c75a6][_0x1553('0x6')]:(_0xe61c57['push'](_0x1090e9),_0x1090e9=_0x578593[_0x5c75a6]);return _0xe61c57[_0x1553('0x1b')](_0x1090e9),_0xe61c57;}(_0x1ef4e7);const _0xd8d61f=_0x21564c['getBoundingClientRect']();return _0x1ef4e7[_0x1553('0xc')](_0x5862cf=>_0x5862cf['top']<=_0xd8d61f[_0x1553('0x22')]&&_0x5862cf[_0x1553('0x3e')]>=_0xd8d61f[_0x1553('0x3e')]&&_0x5862cf[_0x1553('0x3d')]<=_0xd8d61f[_0x1553('0x3d')]&&_0x5862cf['right']>=_0xd8d61f[_0x1553('0x12')])||_0x1ef4e7[0x0];}var _0x8eca6f;return _0x3c787d[_0x1553('0x35')]||_0x21564c;}[_0x1553('0x1f')](_0x8153f4){this['_addedAnnotations']['has'](_0x8153f4)&&this['_balloon'][_0x1553('0x2')](_0x8153f4['view'])&&(this[_0x1553('0x3a')]['delete'](_0x8153f4),this[_0x1553('0x34')]['remove'](_0x8153f4[_0x1553('0x11')]));}['_closeAnnotation'](_0x25fa58){this[_0x1553('0x7')][_0x1553('0x4')](_0x25fa58),this[_0x1553('0x1f')](_0x25fa58);}}function F(_0x3a2cf5,_0x1de23c){return _0x3a2cf5[_0x1553('0x22')]===_0x1de23c['top']&&_0x3a2cf5['bottom']===_0x1de23c[_0x1553('0x3e')]&&_0x3a2cf5['right']===_0x1de23c[_0x1553('0x3d')];}